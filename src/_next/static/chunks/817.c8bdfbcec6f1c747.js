"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{5817:function(e,t,o){o.r(t),o.d(t,{default:function(){return el}});var n,r,a=o(7437),i=o(2265),l=o(4741),s=o(8308),c=o(4673);async function g(e){try{for(let t of e.FS.readdir("/"))if("."!==t&&".."!==t)try{e.FS.unlink("/".concat(t))}catch(e){console.warn("清理文件失败: ".concat(t),e)}}catch(e){console.warn("清理文件系统失败:",e)}}async function d(e){try{let t=e._getMemoryPages(),o=64*Math.ceil(1.5*t/64);o>t&&(console.log("扩展内存: ".concat(t," -> ").concat(o," 页")),e._extendMemory(o))}catch(e){console.warn("扩展内存失败:",e)}}async function h(e,t,o,n,r){if(!window.gifuct)throw Error("gifuct-js 未加载");try{var a,i,l,s;let r=window.gifuct.parseGIF(e),c=window.gifuct.decompressFrames(r,!0);if(!c||0===c.length)throw Error("GIF 没有有效的帧数据");let g=0,d=0;c.forEach(e=>{e.dims&&(g=Math.max(g,e.dims.left+e.dims.width),d=Math.max(d,e.dims.top+e.dims.height))});let h=g||(null===(i=c[0])||void 0===i?void 0:null===(a=i.dims)||void 0===a?void 0:a.width)||100,x=d||(null===(s=c[0])||void 0===s?void 0:null===(l=s.dims)||void 0===l?void 0:l.height)||100,p=document.createElement("canvas");p.width=h,p.height=x;let b=p.getContext("2d");if(!b)throw Error("无法创建累积Canvas上下文");if(r.globalColorTable&&void 0!==r.backgroundColorIndex){let e=r.globalColorTable[r.backgroundColorIndex];e&&(b.fillStyle="rgb(".concat(e[0],", ").concat(e[1],", ").concat(e[2],")"),b.fillRect(0,0,h,x))}else b.clearRect(0,0,h,x);let u=document.createElement("canvas");u.width=o.targetWidth,u.height=o.targetHeight;let f=u.getContext("2d");if(!f)throw Error("无法创建目标Canvas上下文");let m=document.createElement("canvas");m.width=o.targetWidth,m.height=o.targetHeight;let w=m.getContext("2d");if(!w)throw Error("无法创建输出Canvas上下文");for(let e=0;e<c.length;e++){let a=c[e];if(e>0){let t=c[e-1];if(2===t.disposalType){let e=r.backgroundColorIndex||0,o=r.globalColorTable?r.globalColorTable[e]:[0,0,0];b.fillStyle="rgb(".concat(o[0],", ").concat(o[1],", ").concat(o[2],")"),b.fillRect(t.dims.left,t.dims.top,t.dims.width,t.dims.height)}else 3===t.disposalType&&console.warn("Disposal type 3 (restore to previous) 未实现")}if(!a.patch||0===a.patch.length){console.warn("跳过无效帧 ".concat(e+1,": 没有patch数据"));continue}let i=new ImageData(new Uint8ClampedArray(a.patch),a.dims.width,a.dims.height),l=document.createElement("canvas");l.width=a.dims.width,l.height=a.dims.height;let s=l.getContext("2d");if(!s)throw Error("无法创建帧Canvas上下文");s.putImageData(i,0,0),b.globalCompositeOperation="source-over",b.drawImage(l,a.dims.left,a.dims.top);let g=o.targetWidth/h,d=o.targetHeight/x,y=Math.min(g,d),S=h*y,j=x*y,k=(o.targetWidth-S)/2,C=(o.targetHeight-j)/2;if(f.clearRect(0,0,o.targetWidth,o.targetHeight),f.drawImage(p,k,C,S,j),n&&function(e,t,o,n){e.textBaseline="top",t.texts.forEach(t=>{e.font="".concat(t.fontWeight," ").concat(t.fontSize,"px ").concat(t.fontFamily),e.fillStyle=t.color,"vertical"===t.direction?t.text.split("").forEach((r,a)=>{e.fillText(r,t.x+o,t.y+n+a*t.fontSize)}):e.fillText(t.text,t.x+o,t.y+n)}),t.drawings.forEach(t=>{if(e.strokeStyle=t.color,e.lineWidth=t.lineWidth,e.lineCap="round",e.lineJoin="round","brush"===t.type&&t.points.length>0)e.beginPath(),t.points.forEach((t,r)=>{let a=t.x+o,i=t.y+n;0===r?e.moveTo(a,i):e.lineTo(a,i)}),e.stroke();else if("line"===t.type&&2===t.points.length){let[r,a]=t.points;e.beginPath(),e.moveTo(r.x+o,r.y+n),e.lineTo(a.x+o,a.y+n),e.stroke()}else if("rect"===t.type&&2===t.points.length){let[r,a]=t.points;e.strokeRect(r.x+o,r.y+n,a.x-r.x,a.y-r.y)}else if("circle"===t.type&&2===t.points.length){let[r,a]=t.points,i=Math.hypot(a.x-r.x,a.y-r.y);e.beginPath(),e.arc(r.x+o,r.y+n,i,0,2*Math.PI),e.stroke()}})}(f,n,0,0),w.clearRect(0,0,o.targetWidth,o.targetHeight),w.save(),n){let e=o.targetWidth/2,t=o.targetHeight/2;w.translate(e,t),w.rotate(n.rotation*Math.PI/180),w.scale(n.scale/100*(n.flipX?-1:1),n.scale/100*(n.flipY?-1:1)),w.drawImage(u,-e,-t,o.targetWidth,o.targetHeight)}else w.drawImage(u,0,0,o.targetWidth,o.targetHeight);if(w.restore(),n){let e=w.getImageData(0,0,o.targetWidth,o.targetHeight),t=e.data;for(let e=0;e<t.length;e+=4){let o=t[e+3];if(0===o)continue;let r=t[e],a=t[e+1],i=t[e+2];[r,a,i]=function(e,t,o,n){let r=n*Math.PI/180,a=Math.cos(r),i=Math.sin(r);return[e*(.213+.787*a-.213*i)+t*(.715-.715*a-.715*i)+o*(.072-.072*a+.928*i),e*(.213-.213*a+.143*i)+t*(.715+.285*a+.14*i)+o*(.072-.072*a-.283*i),e*(.213-.213*a-.787*i)+t*(.715-.715*a+.715*i)+o*(.072+.928*a+.072*i)]}(r,a,i,n.hue);let l=n.brightness/100;r=Math.min(255,r*l),a=Math.min(255,a*l),i=Math.min(255,i*l);let s=n.contrast/100;r=Math.min(255,Math.max(0,(r-128)*s+128)),a=Math.min(255,Math.max(0,(a-128)*s+128)),i=Math.min(255,Math.max(0,(i-128)*s+128));let c=.299*r+.587*a+.114*i,g=n.saturation/100;r=Math.min(255,Math.max(0,c+(r-c)*g)),a=Math.min(255,Math.max(0,c+(a-c)*g)),i=Math.min(255,Math.max(0,c+(i-c)*g)),t[e]=r,t[e+1]=a,t[e+2]=i}w.putImageData(e,0,0)}let v=m.toDataURL("image/png").split(",")[1],z=Uint8Array.from(atob(v),e=>e.charCodeAt(0));await t.writeFile("input_".concat(e,".png"),z)}return c.length}catch(e){throw console.error("GIF处理失败:",e),e}}async function x(e,t,o){try{let n;let r=e.cwrap("compress_video_wasm","number",["string","string","number","number"]);console.log("compressToQgif 压缩视频: ".concat(t," 帧, ").concat(o," fps"));let a=[()=>r("input_X.png","output.qgif",0,o),()=>r("/input_X.png","/output.qgif",0,o),()=>r("input_X.png","output.qgif",0,o),()=>r("/input_X.png","/output.qgif",0,o)];for(let t=0;t<a.length;t++)try{let o;console.log("尝试压缩方式 ".concat(t+1,"/").concat(a.length));let n=a[t]();console.log("压缩返回值: ".concat(n));try{o=e.FS.readFile("output.qgif")}catch(t){o=e.FS.readFile("/output.qgif")}if(o&&o.length>0)return console.log("压缩成功，QGIF大小: ".concat(o.length," bytes")),o}catch(e){n=e,console.warn("压缩尝试 ".concat(t+1," 失败:"),e)}throw Error("所有压缩尝试都失败: ".concat((null==n?void 0:n.message)||n))}catch(e){throw console.error("压缩为QGIF失败:",e),e}}async function p(e,t,o,n){if(!t)throw Error("设备未连接");o({status:"initializing",currentScreen:0,totalScreens:e.length,bytesTransferred:0,totalBytes:e.reduce((e,t)=>e+t.length,0),percentage:0,message:n("170")});let r=new Uint8Array(65);r[1]=170,r[2]=20,r[6]=56,await t.setData(Array.from(r)),o({status:"preparing",currentScreen:0,totalScreens:e.length,bytesTransferred:0,totalBytes:e.reduce((e,t)=>e+t.length,0),percentage:10,message:n("171")});let a=e.reduce((e,t)=>e+t.length,0),i=Math.ceil(a/65536)+1,l=new Uint8Array(65);l[1]=170,l[2]=21,l[6]=56,l[9]=0,l[10]=e.length,l[11]=i;let s=0,c=12;for(let t=0;t<e.length;t++){l[c++]=s,l[c++]=0;let o=e[t].length;console.log("屏幕 ".concat(t+1," 大小: ").concat(o)),l[c++]=255&o,l[c++]=o>>8&255,l[c++]=o>>16&255,s+=Math.ceil(o/65536)}await t.setData(Array.from(l));let g=new Uint8Array(65);g[1]=170,g[2]=21,g[3]=56,g[4]=0,g[5]=0,g[6]=56,await t.setData(Array.from(g));let d=new Uint8Array(65);d[1]=170,d[2]=21,d[3]=112,d[4]=0,d[5]=0,d[6]=16,await t.setData(Array.from(d));let h=new Uint8Array(65);h[1]=170,h[2]=22,h[6]=56,await t.setData(Array.from(h)),o({status:"erasing",currentScreen:0,totalScreens:e.length,bytesTransferred:0,totalBytes:e.reduce((e,t)=>e+t.length,0),percentage:20,message:n("172")});let x=new Uint8Array(65);x[1]=170,x[2]=24,x[6]=1,x[9]=i,await t.setData(Array.from(x)),await new Promise(e=>setTimeout(e,500*i));let p=0;for(let r=0;r<e.length;r++){let i=e[r],l=0;for(let t=0;t<r;t++)l+=65536*Math.ceil(e[t].length/65536);o({status:"transferring",currentScreen:r+1,totalScreens:e.length,bytesTransferred:p,totalBytes:e.reduce((e,t)=>e+t.length,0),percentage:Math.round(p/a*100),message:"".concat(n("173")," ").concat(r+1," ").concat(n("174"))});for(let s=0;s<i.length;s+=56){let c=new Uint8Array(65);c[1]=170,c[2]=25,c[3]=255&l,c[4]=l>>8&255,c[5]=l>>16&255;let g=Math.min(56,i.length-s);c[6]=g,c.set(i.slice(s,s+g),9),t.setData(Array.from(c)),await Promise.resolve(),l+=g,p+=g,o({status:"transferring",currentScreen:r+1,totalScreens:e.length,bytesTransferred:p,totalBytes:a,percentage:Math.round(p/a*100),message:"".concat(n("173")," ").concat(r+1," ").concat(n("174")," ").concat(Math.round(p/a*100),"%")})}}o({status:"finalizing",currentScreen:e.length,totalScreens:e.length,bytesTransferred:p,totalBytes:a,percentage:100,message:n("175")});let b=new Uint8Array(65);b[1]=170,b[2]=26,await t.setData(Array.from(b)),await t.syncTime();let u=new Uint8Array(65);u[1]=170,u[2]=17,await t.setData(Array.from(u)),o({status:"completed",currentScreen:e.length,totalScreens:e.length,bytesTransferred:p,totalBytes:a,percentage:100,message:n("176")})}(n=r||(r={})).IDLE="idle",n.CONNECTING="connecting",n.SYNCING_TIME="syncing_time",n.INITIALIZING="initializing",n.PREPARING="preparing",n.ERASING="erasing",n.TRANSFERRING="transferring",n.FINALIZING="finalizing",n.COMPLETED="completed",n.ERROR="error";var b=o(4569),u=o(6926),f=o(4285),m=o(67),w=o(1671),y=o(9623),S=o(784),j=e=>{let{gifFiles:t,gifPreviews:o,appliedEditStates:n,selectedScreen:r,onGifUpload:c,onScreenSelect:g,onResetAppliedEdit:d,onDeleteGif:h,screenWidth:x,screenHeight:p,t:j}=e;(0,l.p)();let k=(0,i.useRef)({}),C=(e,t)=>{var o;let n=null===(o=t.target.files)||void 0===o?void 0:o[0];n&&c(e,n)},v=e=>{g(e)},z=e=>{d(e)},F=e=>{h(e),document.getElementById("gif-upload-".concat(e)).value=""},I=e=>{let t=document.getElementById("gif-upload-".concat(e));null==t||t.click()},R=(e,t)=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),t())},E=e=>{let t=n[e];return 100===t.brightness&&100===t.contrast&&100===t.saturation&&0===t.hue&&100===t.scale&&0===t.rotation&&!t.flipX&&!t.flipY&&0===t.texts.length&&0===t.drawings.length},D=(0,i.useCallback)(()=>{n.forEach((e,t)=>{let o=k.current[t];if(!o){console.log("未找到屏幕 ".concat(t+1," 的 canvas"));return}let n=o.getContext("2d");if(!n){console.log("无法获取屏幕 ".concat(t+1," 的 canvas 上下文"));return}n.clearRect(0,0,o.width,o.height),e.texts.forEach((e,t)=>{n.font="".concat(e.fontWeight," ").concat(e.fontSize,"px ").concat(e.fontFamily),n.fillStyle=e.color,"vertical"===e.direction?e.text.split("").forEach((t,o)=>{n.fillText(t,e.x,e.y+o*e.fontSize)}):n.fillText(e.text,e.x,e.y)}),e.drawings.forEach((e,t)=>{if(n.strokeStyle=e.color,n.lineWidth=e.lineWidth,n.lineCap="round",n.lineJoin="round","brush"===e.type)n.beginPath(),e.points.forEach((e,t)=>{0===t?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}),n.stroke();else if("line"===e.type&&2===e.points.length)n.beginPath(),n.moveTo(e.points[0].x,e.points[0].y),n.lineTo(e.points[1].x,e.points[1].y),n.stroke();else if("rect"===e.type&&2===e.points.length){let t=e.points[1].x-e.points[0].x,o=e.points[1].y-e.points[0].y;n.strokeRect(e.points[0].x,e.points[0].y,t,o)}else if("circle"===e.type&&2===e.points.length){let t=e.points[0].x,o=e.points[0].y,r=Math.sqrt(Math.pow(e.points[1].x-t,2)+Math.pow(e.points[1].y-o,2));n.beginPath(),n.arc(t,o,r,0,2*Math.PI),n.stroke()}}),console.log("屏幕 ".concat(t+1," 渲染完成"))})},[n,o]);return(0,i.useEffect)(()=>{console.log(n,o,"gifPreviews"),D()},[n,D,o]),(0,a.jsxs)(s.xu,{position:"absolute",top:"10px",left:"20px",w:"320px",h:"calc(100% - 30px)",bg:"rgba(15, 25, 45, 0.8)",backdropFilter:"blur(12px)",borderRadius:"20px",border:"1px solid rgba(100, 150, 255, 0.2)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",p:5,overflowY:"auto",role:"region","aria-label":"GIF文件管理面板",tabIndex:0,children:[(0,a.jsx)(b.x,{color:"white",fontWeight:"700",fontSize:"lg",textAlign:"center",mb:5,textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",as:"h3",children:j("310")}),(0,a.jsx)(u.g,{spacing:4,children:[0,1,2].map(e=>{var i,l;return(0,a.jsxs)(s.xu,{w:"100%",role:"group","aria-labelledby":"screen-label-".concat(e),children:[(0,a.jsxs)(f.k,{justify:"space-between",align:"center",mb:2,children:[(0,a.jsxs)(b.x,{id:"screen-label-".concat(e),color:"rgba(255, 255, 255, 0.9)",fontWeight:"600",fontSize:"sm",children:[j("311")," ",e+1]}),(0,a.jsxs)(b.x,{color:"rgba(100, 150, 255, 0.8)",fontSize:"xs",fontFamily:"monospace","aria-label":"推荐尺寸240像素宽136像素高",children:[x,"\xd7",p]})]}),(0,a.jsx)("input",{type:"file",accept:"image/gif",style:{display:"none"},id:"gif-upload-".concat(e),onChange:t=>C(e,t),"aria-label":"".concat(j("312")," ").concat(e+1," ").concat(j("313"))}),(0,a.jsx)(f.k,{justify:"center",w:"100%",children:(0,a.jsx)(s.xu,{w:"".concat(x,"px"),h:"".concat(p,"px"),bg:t[e]?"rgba(0, 20, 40, 0.4)":"rgba(30, 40, 60, 0.6)",borderRadius:"12px",overflow:"hidden",border:"2px solid",borderColor:t[e]?"rgba(100, 200, 255, 0.5)":"rgba(100, 150, 255, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",onClick:()=>I(e),onKeyDown:t=>R(t,()=>I(e)),_hover:{borderColor:t[e]?"rgba(100, 200, 255, 0.8)":"rgba(100, 150, 255, 0.6)",bg:t[e]?"rgba(0, 30, 60, 0.6)":"rgba(40, 50, 70, 0.8)",transform:"translateY(-1px)"},transition:"all 0.3s ease",position:"relative",tabIndex:0,role:"button","aria-label":t[e]?"".concat(j("314"),": ").concat(null===(i=t[e])||void 0===i?void 0:i.name):"".concat(j("315")," ").concat(e+1," ").concat(j("316")),children:o[e]?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",{src:o[e],alt:"".concat(j("318")," ").concat(e+1," ").concat(j("319")),style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",borderRadius:"8px",filter:"\n                          brightness(".concat(n[e].brightness,"%) \n                          contrast(").concat(n[e].contrast,"%) \n                          saturate(").concat(n[e].saturation,"%) \n                          hue-rotate(").concat(n[e].hue,"deg)\n                        "),transform:"\n                          scale(".concat(n[e].scale/100,") \n                          rotate(").concat(n[e].rotation,"deg) \n                          scaleX(").concat(n[e].flipX?-1:1,") \n                          scaleY(").concat(n[e].flipY?-1:1,")\n                        "),transformOrigin:"center center",transition:"filter 0.3s ease, transform 0.3s ease"}}),(0,a.jsx)("canvas",{ref:t=>{k.current[e]=t},width:x,height:p,style:{position:"absolute",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",borderRadius:"8px",filter:1===n[e].isHue?"\n                          brightness(".concat(n[e].brightness,"%) \n                          contrast(").concat(n[e].contrast,"%) \n                          saturate(").concat(n[e].saturation,"%) \n                          hue-rotate(").concat(n[e].hue,"deg)\n                        "):"none",transform:1===n[e].isHue?"\n                          scale(".concat(n[e].scale/100,") \n                          rotate(").concat(n[e].rotation,"deg) \n                          scaleX(").concat(n[e].flipX?-1:1,") \n                          scaleY(").concat(n[e].flipY?-1:1,")\n                        "):"none",transformOrigin:"center center",transition:"filter 0.3s ease, transform 0.3s ease"}}),(0,a.jsx)(s.xu,{position:"absolute",bottom:0,left:0,right:0,bg:"rgba(0, 0, 0, 0.8)",p:1,borderBottomRadius:"10px",children:(0,a.jsx)(b.x,{color:"white",fontSize:"xs",textAlign:"center",fontWeight:"500",noOfLines:1,children:null===(l=t[e])||void 0===l?void 0:l.name})})]}):(0,a.jsxs)(u.g,{spacing:2,children:[(0,a.jsx)(m.J,{as:S.UKH,boxSize:8,color:"rgba(255, 255, 255, 0.5)","aria-hidden":"true"}),(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.7)",fontSize:"xs",textAlign:"center",children:j("320")}),(0,a.jsxs)(b.x,{color:"rgba(100, 150, 255, 0.6)",fontSize:"xs",textAlign:"center",children:[j("321"),": ",x,j("322"),p]})]})})}),t[e]&&(0,a.jsxs)(w.U,{spacing:2,mt:2,justify:"center",role:"toolbar","aria-label":"屏幕".concat(e+1,"操作按钮"),children:[(0,a.jsx)(y.z,{size:"xs",variant:"outline",colorScheme:r===e?"blue":"gray",onClick:()=>v(e),onKeyDown:t=>R(t,()=>v(e)),borderColor:"rgba(100, 150, 255, 0.3)",color:"rgba(255, 255, 255, 0.9)",_hover:{bg:"rgba(100, 150, 255, 0.2)",borderColor:"rgba(100, 150, 255, 0.5)"},borderRadius:"6px",fontSize:"xs",tabIndex:0,"aria-label":"编辑屏幕".concat(e+1,"的GIF"),"aria-pressed":r===e,children:j("325")}),(0,a.jsx)(y.z,{size:"xs",variant:"outline",colorScheme:"orange",onClick:()=>z(e),onKeyDown:t=>R(t,()=>z(e)),borderColor:"rgba(255, 150, 100, 0.3)",color:"rgba(255, 150, 100, 0.9)",_hover:{bg:"rgba(255, 150, 100, 0.2)",borderColor:"rgba(255, 150, 100, 0.5)"},borderRadius:"6px",fontSize:"xs",isDisabled:E(e),tabIndex:0,"aria-label":"重置屏幕".concat(e+1,"的编辑状态"),children:j("326")}),(0,a.jsx)(y.z,{size:"xs",variant:"outline",colorScheme:"red",onClick:()=>F(e),onKeyDown:t=>R(t,()=>F(e)),borderColor:"rgba(255, 100, 100, 0.3)",color:"rgba(255, 100, 100, 0.9)",_hover:{bg:"rgba(255, 100, 100, 0.2)",borderColor:"rgba(255, 100, 100, 0.5)"},borderRadius:"6px",fontSize:"xs",tabIndex:0,"aria-label":"删除屏幕".concat(e+1,"的GIF文件"),children:j("327")})]})]},e)})})]})};function k(e){let{selectedScreen:t,gifPreviews:o,editStates:n,appliedEditStates:r,editMode:l,drawingTool:c,brushColor:g,brushSize:d,onCanvasClick:h,onCanvasMouseDown:x,onCanvasMouseMove:p,onCanvasMouseUp:f,onUpdateEditState:w,screenWidth:y,screenHeight:j,t:k}=e,C=(0,i.useRef)(null),v=(0,i.useRef)(null),[z,F]=(0,i.useState)(!1),[I,R]=(0,i.useState)(null),[E,D]=(0,i.useState)(null),[M,T]=(0,i.useState)(!1),[W,A]=(0,i.useState)(null),[_,G]=(0,i.useState)({x:0,y:0}),Y=(0,i.useCallback)(e=>{if(console.log("=== EditCanvas handleMouseDown ==="),console.log("editMode:",l),console.log("selectedScreen:",t),console.log("drawingTool:",c),"text"===l){let o=C.current;if(!o||null===t)return;let r=o.getBoundingClientRect(),a=(e.clientX-r.left)/r.width*o.width,i=(e.clientY-r.top)/r.height*o.height,l=n[t].texts.find(e=>{let t=o.getContext("2d");if(!t)return!1;if(t.font="".concat(e.fontWeight," ").concat(e.fontSize,"px ").concat(e.fontFamily),"vertical"===e.direction){let t=e.text.length*e.fontSize,o=e.fontSize;return a>=e.x&&a<=e.x+o&&i>=e.y&&i<=e.y+t}{let o=t.measureText(e.text);return a>=e.x&&a<=e.x+o.width&&i>=e.y-e.fontSize&&i<=e.y}});l&&(T(!0),A(l.id),G({x:a-l.x,y:i-l.y}),e.stopPropagation())}else if("draw"===l){console.log("开始绘画模式"),F(!0);let o=C.current;if(!o||null===t){console.log("canvas或selectedScreen为空:",{canvas:!!o,selectedScreen:t});return}let r=o.getBoundingClientRect(),a=(e.clientX-r.left)/r.width*o.width,i=(e.clientY-r.top)/r.height*o.height;console.log("鼠标按下位置:",{x:a,y:i}),console.log("画布尺寸:",{width:o.width,height:o.height}),console.log("显示尺寸:",{width:r.width,height:r.height}),R({x:a,y:i});let l={id:Date.now().toString(),type:c,points:[{x:a,y:i}],color:g,lineWidth:d};console.log("创建新绘画元素:",l),D(l);let s=n[t],h=[...s.drawings,l];console.log("当前绘画数组长度:",s.drawings.length),console.log("更新后绘画数组长度:",h.length),w(t,{drawings:h})}else x(e)},[l,t,n,c,g,d,w,x]),P=(0,i.useCallback)(e=>{if("text"===l&&M&&W&&null!==t){let o=C.current;if(!o)return;let r=o.getBoundingClientRect(),a=(e.clientX-r.left)/r.width*o.width,i=(e.clientY-r.top)/r.height*o.height,l=n[t].texts.map(e=>e.id===W?{...e,x:a-_.x,y:i-_.y}:e);w(t,{texts:l})}else if("draw"===l&&z&&E&&null!==t){console.log("=== EditCanvas handleMouseMove (绘画) ===");let o=C.current;if(!o){console.log("canvas为空");return}let r=o.getBoundingClientRect(),a=(e.clientX-r.left)/r.width*o.width,i=(e.clientY-r.top)/r.height*o.height;if(console.log("鼠标移动位置:",{x:a,y:i}),console.log("isDrawing:",z),console.log("currentDrawing:",E),I&&E&&null!==t){let e;"brush"===c?console.log("画笔更新，新增点数:",(e={...E,points:[...E.points,{x:a,y:i}]}).points.length):"line"===c?console.log("直线更新，点数:",(e={...E,points:[E.points[0],{x:a,y:i}]}).points.length):"rect"===c?console.log("矩形更新，点数:",(e={...E,points:[E.points[0],{x:a,y:i}]}).points.length):"circle"===c?console.log("圆形更新，点数:",(e={...E,points:[E.points[0],{x:a,y:i}]}).points.length):e=E,D(e);let o=[...n[t].drawings];o[o.length-1]=e,console.log("更新editStates，绘画数组长度:",o.length),console.log("最后一个绘画元素点数:",e.points.length),w(t,{drawings:o})}R({x:a,y:i})}else p(e)},[l,M,W,t,n,z,E,c,I,_,w,p]),U=(0,i.useCallback)(()=>{"text"===l?(T(!1),A(null),G({x:0,y:0})):"draw"===l?(F(!1),D(null),R(null)):f()},[l,f]),B=(0,i.useCallback)(()=>{if(console.log("=== updateCanvasDisplay ==="),console.log("selectedScreen:",t),console.log("editMode:",l),null===t||!o[t]){console.log("selectedScreen为null或没有gif预览");return}let e=n[t],a=r[t];console.log("editState绘画数组长度:",e.drawings.length),console.log("appliedEditState绘画数组长度:",a.drawings.length);let i=C.current;if(i){console.log("更新交互Canvas - editMode:",l);let t=i.getContext("2d");t?(t.clearRect(0,0,i.width,i.height),console.log("清空画布，尺寸:",i.width,"x",i.height),console.log("绘制文字数量:",e.texts.length),e.texts.forEach(e=>{t.font="".concat(e.fontWeight," ").concat(e.fontSize,"px ").concat(e.fontFamily),t.fillStyle=e.color,"vertical"===e.direction?e.text.split("").forEach((o,n)=>{t.fillText(o,e.x,e.y+n*e.fontSize)}):t.fillText(e.text,e.x,e.y)}),console.log("绘制图形数量:",e.drawings.length),e.drawings.forEach((e,o)=>{if(console.log("绘制第".concat(o+1,"个图形:"),e),e.points.length>0){if(t.strokeStyle=e.color,t.lineWidth=e.lineWidth,t.lineCap="round",t.lineJoin="round","brush"===e.type)console.log("画笔绘制，点数: ".concat(e.points.length)),t.beginPath(),e.points.forEach((e,o)=>{0===o?(t.moveTo(e.x,e.y),console.log("移动到: (".concat(e.x,", ").concat(e.y,")"))):(t.lineTo(e.x,e.y),console.log("连线到: (".concat(e.x,", ").concat(e.y,")")))}),t.stroke(),console.log("画笔绘制完成");else if("line"===e.type&&2===e.points.length)console.log("绘制直线"),t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.stroke();else if("rect"===e.type&&2===e.points.length){console.log("绘制矩形");let o=e.points[1].x-e.points[0].x,n=e.points[1].y-e.points[0].y;t.strokeRect(e.points[0].x,e.points[0].y,o,n)}else if("circle"===e.type&&2===e.points.length){console.log("绘制圆形");let o=e.points[0].x,n=e.points[0].y,r=Math.sqrt(Math.pow(e.points[1].x-o,2)+Math.pow(e.points[1].y-n,2));t.beginPath(),t.arc(o,n,r,0,2*Math.PI),t.stroke()}}else console.log("图形".concat(o+1,"没有点数据"))})):console.log("无法获取canvas上下文")}else console.log("不是文字或绘画模式，或没有canvas");let s=v.current;if(s&&"resize"===l){console.log("更新预览Canvas");let t=s.getContext("2d");t&&(t.clearRect(0,0,s.width,s.height),e.texts.forEach(e=>{t.font="".concat(e.fontWeight," ").concat(e.fontSize,"px ").concat(e.fontFamily),t.fillStyle=e.color,"vertical"===e.direction?e.text.split("").forEach((o,n)=>{t.fillText(o,e.x,e.y+n*e.fontSize)}):t.fillText(e.text,e.x,e.y)}),e.drawings.forEach(e=>{if(e.points.length>0){if(t.strokeStyle=e.color,t.lineWidth=e.lineWidth,t.lineCap="round",t.lineJoin="round","brush"===e.type)t.beginPath(),e.points.forEach((e,o)=>{0===o?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)}),t.stroke();else if("line"===e.type&&2===e.points.length)t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.stroke();else if("rect"===e.type&&2===e.points.length){let o=e.points[1].x-e.points[0].x,n=e.points[1].y-e.points[0].y;t.strokeRect(e.points[0].x,e.points[0].y,o,n)}else if("circle"===e.type&&2===e.points.length){let o=e.points[0].x,n=e.points[0].y,r=Math.sqrt(Math.pow(e.points[1].x-o,2)+Math.pow(e.points[1].y-n,2));t.beginPath(),t.arc(o,n,r,0,2*Math.PI),t.stroke()}}}))}console.log("updateCanvasDisplay 完成",r)},[t,n,r,o,l]);return(0,i.useEffect)(()=>{null!==t&&o[t]&&B()},[t,o,n,l,r,B]),(0,a.jsx)(s.xu,{w:"100%",h:"calc(100% - 260px)",bg:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",border:"1px solid rgba(100, 150, 255, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",mb:4,children:null!==t&&o[t]?(0,a.jsxs)(s.xu,{position:"relative",overflow:"hidden",display:"flex",justifyContent:"center",alignContent:"center",width:y,height:j,border:"2px solid rgba(100, 200, 255, 0.5)",borderRadius:"12px",children:[(0,a.jsx)("img",{src:o[t],alt:"GIF预览".concat(t+1),style:{border:"2px solid rgba(100, 150, 255, 0.3)",borderRadius:"8px",backgroundColor:"rgba(0, 0, 0, 0.1)",display:"block",objectFit:"contain",filter:"\n                brightness(".concat(n[t].brightness,"%) \n                contrast(").concat(n[t].contrast,"%) \n                saturate(").concat(n[t].saturation,"%) \n                hue-rotate(").concat(n[t].hue,"deg)\n              "),transform:"resize"===l?"\n                scale(".concat(n[t].scale/100,") \n                rotate(").concat(n[t].rotation,"deg) \n                scaleX(").concat(n[t].flipX?-1:1,") \n                scaleY(").concat(n[t].flipY?-1:1,")\n              "):"\n                scale(".concat(r[t].scale/100,") \n                rotate(").concat(r[t].rotation,"deg) \n                scaleX(").concat(r[t].flipX?-1:1,") \n                scaleY(").concat(r[t].flipY?-1:1,")\n              "),transformOrigin:"center center",transition:"filter 0.1s ease, transform 0.1s ease"}}),(0,a.jsx)("canvas",{ref:C,width:y,height:j,style:{position:"absolute",top:0,left:0,cursor:"draw"===l?"crosshair":"text"===l?"pointer":"default",backgroundColor:"transparent",filter:1===n[t].isHue?"\n                brightness(".concat(n[t].brightness,"%) \n                contrast(").concat(n[t].contrast,"%) \n                saturate(").concat(n[t].saturation,"%) \n                hue-rotate(").concat(n[t].hue,"deg)\n              "):"none",transform:1===n[t].isHue?"\n                scale(".concat(n[t].scale/100,") \n                rotate(").concat(n[t].rotation,"deg) \n                scaleX(").concat(n[t].flipX?-1:1,") \n                scaleY(").concat(n[t].flipY?-1:1,")\n              "):"none"},onClick:h,onMouseDown:Y,onMouseMove:P,onMouseUp:U,onMouseLeave:U}),null!==t&&(n[t].texts.length>0||n[t].drawings.length>0||n[t].texts.length>0||n[t].drawings.length>0)&&"text"!==l&&"draw"!==l&&(0,a.jsx)("canvas",{ref:v,width:y,height:j,style:{position:"absolute",top:0,left:0,backgroundColor:"transparent",pointerEvents:"none",filter:1===n[t].isHue?"\n                brightness(".concat(n[t].brightness,"%) \n                contrast(").concat(n[t].contrast,"%) \n                saturate(").concat(n[t].saturation,"%) \n                hue-rotate(").concat(n[t].hue,"deg)\n              "):"none",transform:1===n[t].isHue?"\n                scale(".concat(n[t].scale/100,") \n                rotate(").concat(n[t].rotation,"deg) \n                scaleX(").concat(n[t].flipX?-1:1,") \n                scaleY(").concat(n[t].flipY?-1:1,")\n              "):"none"}})]}):(0,a.jsxs)(u.g,{spacing:3,children:[(0,a.jsx)(m.J,{as:S.e0s,boxSize:12,color:"rgba(255, 255, 255, 0.3)"}),(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.5)",fontSize:"lg",textAlign:"center",children:k("280")}),(0,a.jsx)(b.x,{color:"rgba(100, 150, 255, 0.6)",fontSize:"sm",textAlign:"center",children:k("281")})]})})}function C(e){let{editMode:t,selectedScreen:o,onEditModeChange:n,t:r}=e;return(0,a.jsx)(s.xu,{w:"100%",bg:"rgba(0, 0, 0, 0.2)",p:3,borderRadius:"12px",border:"1px solid rgba(100, 150, 255, 0.1)",mb:4,children:(0,a.jsx)(w.U,{spacing:3,justify:"center",children:[{mode:"resize",icon:S._Kw,label:"300"},{mode:"text",icon:S.BAW,label:"301"},{mode:"draw",icon:S.ae8,label:"302"}].map(e=>{let{mode:i,icon:l,label:s}=e;return(0,a.jsx)(y.z,{size:"sm",colorScheme:t===i?"blue":"gray",variant:t===i?"solid":"outline",leftIcon:(0,a.jsx)(m.J,{as:l,boxSize:4}),onClick:()=>n(i),bg:t===i?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"transparent",color:t===i?"white":"rgba(255, 255, 255, 0.9)",borderColor:t===i?"transparent":"rgba(100, 150, 255, 0.4)",_hover:{bg:t===i?"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)":"rgba(100, 150, 255, 0.2)",color:"white",borderColor:t===i?"transparent":"rgba(100, 150, 255, 0.6)"},borderRadius:"8px",fontSize:"sm",fontWeight:"600",isDisabled:!o&&0!==o,children:r(s)},i)})})})}var v=o(8986),z=o(707);function F(e){let{selectedScreen:t,editState:o,onUpdateEditState:n,t:r}=e;return t||0===t?(0,a.jsxs)(u.g,{spacing:4,align:"stretch",children:[[{key:"brightness",label:"250",min:0,max:200,unit:"%"},{key:"contrast",label:"251",min:0,max:200,unit:"%"},{key:"saturation",label:"252",min:0,max:200,unit:"%"},{key:"hue",label:"253",min:-180,max:180,unit:"\xb0"},{key:"scale",label:"254",min:10,max:300,unit:"%"}].map(e=>{let{key:t,label:i,min:l,max:c,unit:g}=e;return(0,a.jsxs)(s.xu,{children:[(0,a.jsxs)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:2,fontWeight:"600",children:[r(i),": ",o[t],g]}),(0,a.jsxs)(v.iR,{value:o[t],min:l,max:c,step:1,size:"md",onChange:e=>n({[t]:e}),children:[(0,a.jsx)(v.Uj,{bg:"rgba(100, 120, 150, 0.3)",borderRadius:"full",children:(0,a.jsx)(v.Ms,{bg:"linear-gradient(90deg, #667eea 0%, #764ba2 100%)",borderRadius:"full"})}),(0,a.jsx)(v.gs,{boxSize:5,bg:"white",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"})]})]},t)}),(0,a.jsxs)(s.xu,{mt:6,children:[(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:3,fontWeight:"600",children:r("260")}),(0,a.jsx)(z.r,{templateColumns:"repeat(2, 1fr)",gap:2,children:[{icon:S.PoU,label:"258",action:()=>{n({rotation:(o.rotation-90)%360})}},{icon:S.Z8c,label:"259",action:()=>{n({rotation:(o.rotation+90)%360})}},{icon:null,label:"256",action:()=>{n({flipX:!o.flipX})}},{icon:null,label:"257",action:()=>{n({flipY:!o.flipY})}}].map((e,t)=>(0,a.jsxs)(y.z,{size:"sm",variant:"outline",onClick:e.action,borderColor:"rgba(100, 150, 255, 0.3)",color:"rgba(255, 255, 255, 0.9)",_hover:{bg:"rgba(100, 150, 255, 0.2)",borderColor:"rgba(100, 150, 255, 0.5)"},borderRadius:"8px",fontSize:"xs",children:[e.icon&&(0,a.jsx)(m.J,{as:e.icon,boxSize:3,mr:1}),r(e.label)]},t))})]})]}):null}var I=o(3697),R=o(6552),E=o(3518),D=o(3738);function M(e){let{selectedScreen:t,texts:o,newText:n,textColor:r,fontSize:i,fontFamily:l,textDirection:c,onNewTextChange:g,onTextColorChange:d,onFontSizeChange:h,onFontFamilyChange:x,onTextDirectionChange:p,onAddText:f,onDeleteText:m,t:S}=e;return(0,a.jsxs)(u.g,{spacing:4,align:"stretch",children:[(0,a.jsxs)(I.b,{status:"info",borderRadius:"8px",bg:"rgba(0, 100, 255, 0.1)",border:"1px solid rgba(0, 100, 255, 0.3)",children:[(0,a.jsx)(R.z,{color:"rgba(0, 100, 255, 0.8)"}),(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"xs",children:S("350")})]}),(0,a.jsxs)(s.xu,{children:[(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:2,fontWeight:"600",children:S("351")}),(0,a.jsxs)(w.U,{spacing:2,children:[(0,a.jsx)(E.I,{value:n,onChange:e=>g(e.target.value),placeholder:S("352"),bg:"gray.700",border:"1px solid",borderColor:"gray.600",_focus:{borderColor:"blue.400"},color:"white",size:"sm",flex:1}),(0,a.jsx)(y.z,{size:"sm",colorScheme:"blue",onClick:f,isDisabled:!n.trim(),bg:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",_hover:{bg:"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)"},px:4,children:S("351")})]})]}),(0,a.jsxs)(s.xu,{children:[(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:2,fontWeight:"600",children:S("353")}),(0,a.jsx)("input",{type:"color",value:r,onChange:e=>d(e.target.value),style:{width:"100%",height:"40px",border:"none",borderRadius:"8px",cursor:"pointer"}})]}),(0,a.jsxs)(s.xu,{children:[(0,a.jsxs)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:2,fontWeight:"600",children:[S("354"),": ",i,"px"]}),(0,a.jsxs)(v.iR,{value:i,min:8,max:48,step:1,size:"md",onChange:h,children:[(0,a.jsx)(v.Uj,{bg:"rgba(100, 120, 150, 0.3)",borderRadius:"full",children:(0,a.jsx)(v.Ms,{bg:"linear-gradient(90deg, #667eea 0%, #764ba2 100%)",borderRadius:"full"})}),(0,a.jsx)(v.gs,{boxSize:5,bg:"white"})]})]}),(0,a.jsxs)(s.xu,{children:[(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:2,fontWeight:"600",children:S("355")}),(0,a.jsxs)(D.P,{value:l,onChange:e=>x(e.target.value),bg:"rgba(50, 60, 80, 0.8)",border:"1px solid",borderColor:"rgba(100, 150, 255, 0.3)",_focus:{borderColor:"rgba(100, 150, 255, 0.6)",boxShadow:"0 0 0 1px rgba(100, 150, 255, 0.3)"},_hover:{borderColor:"rgba(100, 150, 255, 0.4)"},color:"white",size:"sm",sx:{option:{backgroundColor:"#2D3748",color:"white",_hover:{backgroundColor:"#4A5568"},_selected:{backgroundColor:"rgba(100, 150, 255, 0.2)"}}},children:[(0,a.jsx)("option",{value:"Arial",style:{backgroundColor:"#2D3748",color:"white"},children:"Arial"}),(0,a.jsx)("option",{value:"Microsoft YaHei",style:{backgroundColor:"#2D3748",color:"white"},children:"微软雅黑"}),(0,a.jsx)("option",{value:"SimHei",style:{backgroundColor:"#2D3748",color:"white"},children:"黑体"}),(0,a.jsx)("option",{value:"KaiTi",style:{backgroundColor:"#2D3748",color:"white"},children:"楷体"}),(0,a.jsx)("option",{value:"Times New Roman",style:{backgroundColor:"#2D3748",color:"white"},children:"Times New Roman"}),(0,a.jsx)("option",{value:"Georgia",style:{backgroundColor:"#2D3748",color:"white"},children:"Georgia"}),(0,a.jsx)("option",{value:"Verdana",style:{backgroundColor:"#2D3748",color:"white"},children:"Verdana"})]})]}),(0,a.jsxs)(s.xu,{children:[(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:2,fontWeight:"600",children:S("356")}),(0,a.jsxs)(D.P,{value:c,onChange:e=>p(e.target.value),bg:"rgba(50, 60, 80, 0.8)",border:"1px solid",borderColor:"rgba(100, 150, 255, 0.3)",_focus:{borderColor:"rgba(100, 150, 255, 0.6)",boxShadow:"0 0 0 1px rgba(100, 150, 255, 0.3)"},_hover:{borderColor:"rgba(100, 150, 255, 0.4)"},color:"white",size:"sm",sx:{option:{backgroundColor:"#2D3748",color:"white",_hover:{backgroundColor:"#4A5568"},_selected:{backgroundColor:"rgba(100, 150, 255, 0.2)"}}},children:[(0,a.jsx)("option",{value:"horizontal",style:{backgroundColor:"#2D3748",color:"white"},children:S("361")}),(0,a.jsx)("option",{value:"vertical",style:{backgroundColor:"#2D3748",color:"white"},children:S("362")})]})]}),null!==t&&o.length>0&&(0,a.jsxs)(s.xu,{children:[(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:2,fontWeight:"600",children:S("357")}),(0,a.jsx)(u.g,{spacing:2,maxH:"150px",overflowY:"auto",children:o.map(e=>(0,a.jsxs)(s.xu,{p:3,bg:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",border:"1px solid rgba(100, 150, 255, 0.2)",cursor:"pointer",onClick:()=>m(e.id),_hover:{bg:"rgba(255, 0, 0, 0.2)",borderColor:"rgba(255, 100, 100, 0.5)"},w:"100%",children:[(0,a.jsx)(b.x,{color:e.color,fontSize:"sm",noOfLines:1,fontFamily:e.fontFamily,fontWeight:e.fontWeight,children:e.text}),(0,a.jsxs)(b.x,{color:"rgba(255, 255, 255, 0.6)",fontSize:"xs",children:[S("358"),": ",e.fontFamily," | ",S("359"),": ",e.fontSize,"px | ",S("360"),": ","horizontal"===e.direction?S("361"):S("362")]})]},e.id))})]})]})}function T(e){let{drawingTool:t,brushColor:o,brushSize:n,onDrawingToolChange:r,onBrushColorChange:i,onBrushSizeChange:l,onClearDrawings:c,t:g}=e;return(0,a.jsxs)(u.g,{spacing:4,align:"stretch",children:[(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",fontWeight:"600",children:"\uD83C\uDFA8 绘画工具"}),(0,a.jsx)(z.r,{templateColumns:"repeat(2, 1fr)",gap:2,children:[{tool:"brush",icon:S.ae8,label:"270"},{tool:"line",icon:null,label:"271"},{tool:"rect",icon:null,label:"272"},{tool:"circle",icon:null,label:"273"}].map(e=>{let{tool:o,icon:n,label:i}=e;return(0,a.jsx)(y.z,{size:"sm",color:"rgba(255, 255, 255, 0.9)",variant:t===o?"solid":"outline",colorScheme:t===o?"blue":"gray",onClick:()=>r(o),leftIcon:n?(0,a.jsx)(m.J,{as:n,boxSize:3}):void 0,bg:t===o?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"transparent",_hover:{bg:t===o?"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)":"rgba(100, 150, 255, 0.1)"},borderRadius:"8px",fontSize:"xs",children:g(i)},o)})}),(0,a.jsxs)(s.xu,{children:[(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:2,fontWeight:"600",children:g("274")}),(0,a.jsx)("input",{type:"color",value:o,onChange:e=>i(e.target.value),style:{width:"100%",height:"40px",border:"none",borderRadius:"8px",cursor:"pointer"}})]}),(0,a.jsxs)(s.xu,{children:[(0,a.jsxs)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",mb:2,fontWeight:"600",children:[g("277"),": ",n,"px"]}),(0,a.jsxs)(v.iR,{value:n,min:1,max:20,step:1,size:"md",onChange:l,children:[(0,a.jsx)(v.Uj,{bg:"rgba(100, 120, 150, 0.3)",borderRadius:"full",children:(0,a.jsx)(v.Ms,{bg:"linear-gradient(90deg, #667eea 0%, #764ba2 100%)",borderRadius:"full"})}),(0,a.jsx)(v.gs,{boxSize:5,bg:"white"})]})]}),(0,a.jsx)(y.z,{size:"sm",colorScheme:"red",leftIcon:(0,a.jsx)(S.lUB,{}),onClick:c,bg:"linear-gradient(135deg, #e53e3e 0%, #c53030 100%)",_hover:{bg:"linear-gradient(135deg, #c53030 0%, #9c2626 100%)"},borderRadius:"8px",fontSize:"sm",children:g("276")})]})}function W(e){let{selectedScreen:t,editMode:o,editStates:n,drawingTool:r,brushColor:i,brushSize:l,newText:c,textColor:g,fontSize:d,fontFamily:h,textDirection:x,onUpdateEditState:p,onDrawingToolChange:f,onBrushColorChange:w,onBrushSizeChange:y,onNewTextChange:j,onTextColorChange:k,onFontSizeChange:C,onFontFamilyChange:v,onTextDirectionChange:z,onAddText:I,onDeleteText:R,onClearDrawings:E,t:D}=e,W=null!==t?n[t]:null;return(0,a.jsx)(s.xu,{bg:"rgba(0, 0, 0, 0.3)",p:4,borderRadius:"12px",border:"1px solid rgba(100, 150, 255, 0.1)",h:"calc(100% - 60px)",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0, 0, 0, 0.1)",borderRadius:"2px"},"&::-webkit-scrollbar-thumb":{background:"rgba(100, 150, 255, 0.3)",borderRadius:"2px"}},children:null===t?(0,a.jsxs)(u.g,{spacing:3,justify:"center",h:"100%",children:[(0,a.jsx)(m.J,{as:S.zmo,boxSize:8,color:"rgba(255, 255, 255, 0.3)"}),(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.5)",fontSize:"sm",textAlign:"center",children:D("290")})]}):(0,a.jsxs)(a.Fragment,{children:["resize"===o&&W&&(0,a.jsx)(F,{selectedScreen:t,editState:W,onUpdateEditState:e=>p(t,e),t:D}),"text"===o&&W&&(0,a.jsx)(M,{selectedScreen:t,texts:W.texts,newText:c,textColor:g,fontSize:d,fontFamily:h,textDirection:x,onNewTextChange:j,onTextColorChange:k,onFontSizeChange:C,onFontFamilyChange:v,onTextDirectionChange:z,onAddText:I,onDeleteText:R,t:D}),"draw"===o&&(0,a.jsx)(T,{drawingTool:r,brushColor:i,brushSize:l,onDrawingToolChange:f,onBrushColorChange:w,onBrushSizeChange:y,onClearDrawings:E,t:D})]})})}var A=e=>{let{onSyncTime:t,onClearData:o,t:n}=e,[r,l]=(0,i.useState)(new Date);(0,i.useEffect)(()=>{let e=setInterval(()=>{l(new Date)},1e3);return()=>clearInterval(e)},[]);let c=()=>{t()},g=(e,t)=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),t())};return(0,a.jsxs)(s.xu,{position:"absolute",top:"10px",right:"20px",w:"320px",h:"230px",bg:"rgba(15, 25, 45, 0.8)",backdropFilter:"blur(12px)",borderRadius:"20px",border:"1px solid rgba(100, 150, 255, 0.2)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",p:5,role:"region","aria-label":n("380"),tabIndex:0,children:[(0,a.jsx)(b.x,{color:"white",fontWeight:"700",fontSize:"lg",textAlign:"center",mb:4,textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",as:"h3",children:n("380")}),(0,a.jsxs)(u.g,{spacing:3,align:"center",children:[(0,a.jsxs)(s.xu,{textAlign:"center",role:"timer","aria-live":"polite",children:[(0,a.jsxs)(b.x,{fontSize:"sm",fontWeight:"600",color:"rgba(255, 255, 255, 0.9)",children:[r.getFullYear(),"-",String(r.getMonth()+1).padStart(2,"0"),"-",String(r.getDate()).padStart(2,"0")]}),(0,a.jsx)(b.x,{fontSize:"xs",color:"rgba(100, 150, 255, 0.8)",mb:2,children:[n("390"),n("391"),n("392"),n("393"),n("394"),n("395"),n("396")][r.getDay()]}),(0,a.jsxs)(b.x,{fontSize:"2xl",fontWeight:"700",color:"white",fontFamily:"monospace",textShadow:"0 0 15px rgba(100, 150, 255, 0.5)",letterSpacing:"0.1em","aria-label":"".concat(n("386")," ").concat(String(r.getHours()).padStart(2,"0")).concat(n("387")).concat(String(r.getMinutes()).padStart(2,"0")).concat(n("388")).concat(String(r.getSeconds()).padStart(2,"0")).concat(n("389")),children:[String(r.getHours()).padStart(2,"0"),":",String(r.getMinutes()).padStart(2,"0"),":",String(r.getSeconds()).padStart(2,"0")]})]}),(0,a.jsx)(y.z,{size:"md",colorScheme:"blue",leftIcon:(0,a.jsx)(S.S2h,{}),onClick:c,onKeyDown:e=>g(e,c),bg:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",_hover:{bg:"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)",transform:"translateY(-2px)"},borderRadius:"12px",fontSize:"sm",fontWeight:"600",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.3)",px:6,py:3,tabIndex:0,"aria-label":n("381"),children:n("381")})]})]})},_=o(8838),G=e=>{let{selectedScreen:t,hasValidGifs:o,onApplyEdit:n,onResetEdit:r,onDownloadToDevice:i,isDownloading:l=!1,downloadProgress:c,t:g}=e,d=()=>{n()},h=()=>{r()},x=()=>{i()},p=(e,t)=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),t())};return(0,a.jsxs)(s.xu,{mt:4,role:"toolbar","aria-label":g("230"),children:[(0,a.jsxs)(w.U,{spacing:3,justify:"center",children:[(0,a.jsx)(y.z,{size:"md",colorScheme:"green",leftIcon:(0,a.jsx)(S.HhX,{}),onClick:d,onKeyDown:e=>p(e,d),isDisabled:null===t||l,bg:"linear-gradient(135deg, #48bb78 0%, #38a169 100%)",_hover:{bg:"linear-gradient(135deg, #38a169 0%, #2f855a 100%)",transform:"translateY(-2px)"},_disabled:{bg:"rgba(80, 80, 80, 0.5)",color:"rgba(255, 255, 255, 0.3)"},borderRadius:"12px",fontSize:"sm",fontWeight:"600",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.3)",px:6,py:3,tabIndex:0,"aria-label":"应用当前编辑到GIF",children:g("231")}),(0,a.jsx)(y.z,{size:"md",colorScheme:"gray",leftIcon:(0,a.jsx)(S.la_,{}),onClick:h,onKeyDown:e=>p(e,h),isDisabled:null===t||l,bg:"linear-gradient(135deg, #718096 0%, #4a5568 100%)",_hover:{bg:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",transform:"translateY(-2px)"},_disabled:{bg:"rgba(80, 80, 80, 0.5)",color:"rgba(255, 255, 255, 0.3)"},borderRadius:"12px",fontSize:"sm",fontWeight:"600",boxShadow:"0 4px 15px rgba(113, 128, 150, 0.3)",px:6,py:3,tabIndex:0,"aria-label":"重置当前编辑状态",children:g("232")}),(0,a.jsx)(y.z,{size:"md",colorScheme:"blue",leftIcon:l?(0,a.jsx)(S.S2h,{className:"animate-spin"}):(0,a.jsx)(S.uKn,{}),onClick:x,onKeyDown:e=>p(e,x),isDisabled:!o||l,isLoading:l,bg:"linear-gradient(135deg, #4299e1 0%, #3182ce 100%)",_hover:{bg:"linear-gradient(135deg, #3182ce 0%, #2c5282 100%)",transform:"translateY(-2px)"},_disabled:{bg:"rgba(80, 80, 80, 0.5)",color:"rgba(255, 255, 255, 0.3)"},borderRadius:"12px",fontSize:"sm",fontWeight:"600",boxShadow:"0 4px 15px rgba(66, 153, 225, 0.3)",px:6,py:3,tabIndex:0,"aria-label":g("233"),children:g("233")})]}),l&&c&&(0,a.jsxs)(s.xu,{mt:3,px:4,children:[(0,a.jsx)(_.E,{value:c.percentage,colorScheme:"blue",size:"sm",borderRadius:"md",bg:"rgba(255, 255, 255, 0.1)"}),(0,a.jsx)(b.x,{fontSize:"xs",color:"rgba(255, 255, 255, 0.8)",textAlign:"center",mt:1,children:c.message})]})]})},Y=o(9235),P=o.n(Y),U=e=>{let{gifFiles:t,gifPreviews:o,appliedEditStates:n,onGifUpload:r,onAppliedEditStatesChange:c,onGifFilesChange:g,onGifPreviewsChange:d,onSyncTime:h,onClearData:x,onDownloadToDevice:p,isDownloading:u,downloadProgress:f,screenWidth:m,screenHeight:w,t:y}=e,S=(0,l.p)(),[v,z]=(0,i.useState)(null),[F,I]=(0,i.useState)([{isHue:0,brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[]},{isHue:0,brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[]},{isHue:0,brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[]}]),[R,E]=(0,i.useState)("resize"),[D,M]=(0,i.useState)("brush"),[T,_]=(0,i.useState)("#ffffff"),[Y,U]=(0,i.useState)(3),[B,H]=(0,i.useState)("#ffffff"),[X,N]=(0,i.useState)(16),[L,O]=(0,i.useState)("Arial"),[J,q]=(0,i.useState)("horizontal"),[K,Q]=(0,i.useState)(""),[Z,V]=(0,i.useState)(!1),[$,ee]=(0,i.useState)(null),[et,eo]=(0,i.useState)({x:0,y:0}),en=(0,i.useCallback)((e,t)=>{console.log("=== handleUpdateEditState ==="),console.log("screenIdx:",e),console.log("updates:",t),I(o=>{let n=[...o],r=n[e];return n[e]={...n[e],...t},console.log("旧editState绘画数组长度:",r.drawings.length),console.log("新editState绘画数组长度:",n[e].drawings.length),t.drawings&&console.log("绘画更新详情:",t.drawings),n})},[]);(0,i.useEffect)(()=>{n&&(I(n),console.log(n))},[n,v]);let er=(0,i.useCallback)(e=>{I(t=>{let o=[...t];return o[e]={brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[],isHue:0},o}),console.log(F[e])},[F]),ea=(0,i.useCallback)(function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],o=[...n];o[e]={brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[],isHue:0},c(o),t&&S({title:y("200"),description:"".concat(y("201")," ").concat(e+1," ").concat(y("202")),status:"success"})},[n,c,S]),ei=(0,i.useCallback)(async e=>{try{let t=await P().getItem("gifFilesData");t&&Array.isArray(t)&&(t[e]=null,await P().setItem("gifFilesData",t))}catch(e){console.error("清理本地GIF文件数据失败:",e)}let n=[...t];n[e]=null,g(n);let r=[...o];r[e]&&(URL.revokeObjectURL(r[e]),r[e]=null),d(r),er(e),ea(e),v===e&&z(null)},[t,o,v,g,d,er,ea]),el=(0,i.useCallback)(()=>{if(null===v||!t[v]||!o[v]){S({title:y("203"),description:y("204"),status:"warning"});return}let e=F[v],r=n[v];if(!(JSON.stringify(e)!==JSON.stringify(r))){S({title:y("205"),description:y("206"),status:"info"});return}try{let t=[...n];t[v]={...e},console.log(t),c(t)}catch(e){console.error("应用编辑失败:",e)}},[v,t,o,F,n,c,er,S]),es=(0,i.useCallback)(()=>{if(null===v||!K.trim())return;let e={id:Date.now().toString(),text:K.trim(),x:120,y:68,color:B,fontSize:X,fontFamily:L,fontWeight:"normal",direction:J};en(v,{texts:[...F[v].texts,e]}),Q("")},[v,K,B,X,L,J,F,en]),ec=(0,i.useCallback)(e=>{if(null===v)return;let t=F[v].texts.filter(t=>t.id!==e);en(v,{texts:t})},[v,F,en]),eg=(0,i.useCallback)(()=>{null!==v&&en(v,{drawings:[]})},[v,en]),ed=(0,i.useCallback)(e=>{},[]),eh=(0,i.useCallback)(e=>{console.log("=== GifEditor handleCanvasMouseDown ==="),console.log("editMode:",R),console.log("selectedScreen:",v)},[R,v]),ex=(0,i.useCallback)(e=>{},[]),ep=(0,i.useCallback)(()=>{},[]),eb=t.some(e=>null!==e),eu=(0,i.useCallback)((e,t)=>{r(e,t),er(e),ea(e,!1)},[r,ea]);return(0,a.jsxs)(s.xu,{w:"100%",h:"100%",bg:"black",position:"relative",overflow:"hidden",role:"main","aria-label":y("210"),children:[(0,a.jsx)(j,{gifFiles:t,gifPreviews:o,appliedEditStates:n,selectedScreen:v,onGifUpload:eu,onScreenSelect:z,onResetAppliedEdit:ea,onDeleteGif:ei,screenWidth:m,screenHeight:w,t:y}),(0,a.jsxs)(s.xu,{position:"absolute",top:"10px",left:"360px",w:"calc(100% - 720px)",h:"calc(100% - 30px)",bg:"rgba(15, 25, 45, 0.8)",backdropFilter:"blur(12px)",borderRadius:"20px",border:"1px solid rgba(100, 150, 255, 0.2)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",p:5,overflowY:"auto",role:"region","aria-label":"编辑区域",tabIndex:0,children:[(0,a.jsx)(b.x,{mb:4,fontWeight:"700",color:"white",textAlign:"center",fontSize:"lg",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",as:"h2",children:y("211")}),(0,a.jsx)(C,{editMode:R,selectedScreen:v,onEditModeChange:E,t:y}),(0,a.jsx)(k,{selectedScreen:v,gifPreviews:o,editStates:F,appliedEditStates:n,editMode:R,drawingTool:D,brushColor:T,brushSize:Y,onCanvasClick:ed,onCanvasMouseDown:eh,onCanvasMouseMove:ex,onCanvasMouseUp:ep,onUpdateEditState:en,screenWidth:m,screenHeight:w,t:y}),(0,a.jsx)(G,{selectedScreen:v,hasValidGifs:eb,onApplyEdit:el,onResetEdit:()=>null!==v&&er(v),onDownloadToDevice:p,isDownloading:u,downloadProgress:f,t:y})]}),(0,a.jsx)(A,{onSyncTime:h,onClearData:x,t:y}),(0,a.jsxs)(s.xu,{position:"absolute",top:"260px",right:"20px",w:"320px",h:"calc(100% - 280px)",bg:"rgba(15, 25, 45, 0.8)",backdropFilter:"blur(12px)",borderRadius:"20px",border:"1px solid rgba(100, 150, 255, 0.2)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",p:5,overflowY:"auto",role:"complementary","aria-label":"编辑工具面板",tabIndex:0,children:[(0,a.jsx)(b.x,{color:"white",fontWeight:"700",fontSize:"lg",textAlign:"center",mb:4,textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",as:"h3",children:y("212")}),(0,a.jsx)(W,{selectedScreen:v,editMode:R,editStates:F,drawingTool:D,brushColor:T,brushSize:Y,newText:K,textColor:B,fontSize:X,fontFamily:L,textDirection:J,onUpdateEditState:en,onDrawingToolChange:M,onBrushColorChange:_,onBrushSizeChange:U,onNewTextChange:Q,onTextColorChange:H,onFontSizeChange:N,onFontFamilyChange:O,onTextDirectionChange:q,onAddText:es,onDeleteText:ec,onClearDrawings:eg,t:y})]})]})},B=o(5059),H=o(9528),X=o(4215),N=o(9174),L=o(20),O=o(4428),J=o(6432),q=o(1093),K=o(4097);function Q(){let{connectDevice:e,connctKeyBoardDevice:t}=(0,i.useContext)(c.T),{changeLanguage:o,i18n:n,t:r}=(0,q.$)("common"),[l,g]=(0,i.useState)(!1),[d,h]=(0,i.useState)(0);(0,i.useEffect)(()=>{let e=setInterval(()=>{h(e=>(e+1)%3)},3e3);return()=>clearInterval(e)},[]);let x=e=>{o(e)};return(0,a.jsxs)(s.xu,{w:"100%",h:"100%",position:"relative",children:[(0,a.jsx)(s.xu,{position:"fixed",top:0,left:0,w:"100vw",h:"100vh",overflow:"hidden",bg:"black",children:(0,a.jsxs)(s.xu,{position:"relative",width:"100%",height:"100%",children:[(0,a.jsx)(B.E,{src:"./keyboard_bg.png",alt:"Background",style:{width:"100%",height:"100%",objectFit:"cover",position:"absolute",top:0,left:0}}),(0,a.jsx)(s.xu,{position:"absolute",top:0,left:0,right:0,bottom:0,bgImage:"url('./grid_pattern.png')",bgSize:"cover",opacity:.15,sx:{animation:"gridMove 40s linear infinite"}}),(0,a.jsx)(s.xu,{position:"absolute",top:0,left:0,right:0,bottom:0,sx:{"&::before, &::after":{content:'""',position:"absolute",width:"2px",height:"2px",borderRadius:"50%",background:"rgba(0, 150, 255, 0.7)",boxShadow:"0 0 10px 2px rgba(0, 150, 255, 0.5)",animation:"blink 3s infinite"},"&::before":{top:"30%",left:"75%",animationDelay:"0.5s"},"&::after":{top:"65%",left:"20%",animationDelay:"1.5s"}}}),(0,a.jsx)(s.xu,{position:"absolute",top:0,left:0,right:0,bottom:0,bgGradient:"linear(to-b, rgba(0, 0, 0, 0.7), rgba(20, 20, 40, 0.6), rgba(0, 0, 0, 0.7))",backdropFilter:"blur(5px)",sx:{animation:"gradientShift 10s ease-in-out infinite"}}),(0,a.jsx)(s.xu,{position:"absolute",top:0,left:0,right:0,height:"30px",bgGradient:"linear(to-b, rgba(0, 150, 255, 0.2), transparent)",sx:{animation:"gradientShift 8s ease-in-out infinite 1s"}}),(0,a.jsx)(s.xu,{position:"absolute",bottom:0,left:0,right:0,height:"30px",bgGradient:"linear(to-t, rgba(0, 150, 255, 0.2), transparent)",sx:{animation:"gradientShift 8s ease-in-out infinite"}})]})}),(0,a.jsxs)(s.xu,{w:"100%",h:"100vh",position:"relative",zIndex:1,overflowY:"auto",overflowX:"hidden",pb:"3rem",sx:{"@keyframes gridMove":{"0%":{transform:"translateY(0) scale(1)"},"50%":{transform:"translateY(-20px) scale(1.05)"},"100%":{transform:"translateY(0) scale(1)"}},"@keyframes blink":{"0%":{opacity:.3,transform:"scale(0.8)"},"50%":{opacity:1,transform:"scale(1.2)"},"100%":{opacity:.3,transform:"scale(0.8)"}},"@keyframes gradientShift":{"0%":{opacity:.7},"50%":{opacity:.9},"100%":{opacity:.7}},"@keyframes floatEffect":{"0%":{transform:"translateY(0px)"},"50%":{transform:"translateY(-10px)"},"100%":{transform:"translateY(0px)"}},"@keyframes particleFloat":{"0%":{transform:"translateY(0px) translateX(0px)"},"50%":{transform:"translateY(-10px) translateX(5px)"},"100%":{transform:"translateY(0px) translateX(0px)"}},"@keyframes pulseGlow":{"0%":{opacity:.3},"50%":{opacity:.8},"100%":{opacity:.3}},"@keyframes keyPress":{"0%":{transform:"translateY(0px)"},"50%":{transform:"translateY(2px)"},"100%":{transform:"translateY(0px)"}},"@keyframes pixelate":{"0%":{filter:"none"},"5%":{filter:"brightness(1.1) contrast(1.3)"},"10%":{filter:"none"},"15%":{filter:"brightness(0.9) contrast(1.2)"},"20%":{filter:"none"},"100%":{filter:"none"}},"@keyframes scanline":{"0%":{transform:"translateY(-100%)"},"100%":{transform:"translateY(100%)"}},"@keyframes textFlow":{"0%":{backgroundPosition:"200% center"},"100%":{backgroundPosition:"0% center"}},"@keyframes screenFlicker":{"0%":{opacity:1},"49%":{opacity:1},"50%":{opacity:.95},"51%":{opacity:1},"52%":{opacity:1},"53%":{opacity:.9},"54%":{opacity:1},"100%":{opacity:1}},"&::-webkit-scrollbar":{width:"3px"},"&::-webkit-scrollbar-track":{width:"4px",background:"rgba(0, 0, 0, 0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(0, 150, 255, 0.5)",borderRadius:"24px"}},children:[(0,a.jsx)(s.xu,{children:(0,a.jsxs)(s.xu,{h:"60px",display:"flex",justifyContent:"space-between",alignItems:"center",px:4,bg:"rgba(20, 20, 40, 0.8)",backdropFilter:"blur(10px)",borderBottom:"1px solid rgba(0, 150, 255, 0.3)",boxShadow:"0 1px 6px rgba(0, 150, 255, 0.2)",children:[(0,a.jsx)(s.xu,{display:"flex",alignItems:"center",children:(0,a.jsx)(b.x,{color:"white",fontWeight:"bold",fontSize:{base:"24px",md:"36px"},position:"relative",className:"logo-text",lineHeight:"1",sx:{background:"linear-gradient(90deg, #00BFFF, #0080FF, #1E90FF, #0080FF, #00BFFF)",backgroundSize:"200% auto",animation:"textFlow 3s linear infinite",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"0 0 8px rgba(0, 150, 255, 0.3)"},children:r("11")})}),(0,a.jsx)(s.xu,{display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:1e5,children:(0,a.jsxs)(H.v,{closeOnSelect:!0,children:[(0,a.jsx)(X.j,{as:N.h,"aria-label":"Language",icon:(0,a.jsxs)(s.xu,{position:"relative",w:"24px",h:"24px",children:[(0,a.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M7 12H17",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M12 7V17",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M12 22C14.5 22 16.5 17.5228 16.5 12C16.5 6.47715 14.5 2 12 2C9.5 2 7.5 6.47715 7.5 12C7.5 17.5228 9.5 22 12 22Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,a.jsx)(b.x,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"8px",fontWeight:"bold",color:"white",bg:"rgba(0, 0, 0, 0.5)",px:"2px",borderRadius:"2px",children:"cn"===n.language?"中":"EN"})]}),variant:"ghost",colorScheme:"whiteAlpha",_hover:{bg:"rgba(0, 150, 255, 0.3)"}}),(0,a.jsx)(L.h,{children:(0,a.jsxs)(O.q,{bg:"#1A1C2E",borderColor:"#2A3056",boxShadow:"0 4px 12px rgba(0, 150, 255, 0.2)",borderRadius:"8px",p:1,minW:"120px",zIndex:999999,children:[(0,a.jsx)(J.s,{onClick:e=>{e.stopPropagation(),x("cn")},bg:"transparent",color:"white",fontSize:"sm",p:3,borderRadius:"4px",_hover:{bg:"rgba(0, 150, 255, 0.6)"},_focus:{bg:"rgba(0, 150, 255, 0.6)"},children:"中文"}),(0,a.jsx)(J.s,{onClick:e=>{e.stopPropagation(),x("en")},bg:"transparent",color:"white",fontSize:"sm",p:3,borderRadius:"4px",_hover:{bg:"rgba(0, 150, 255, 0.6)"},_focus:{bg:"rgba(0, 150, 255, 0.6)"},children:"English"})]})})]})})]})}),(0,a.jsxs)(f.k,{direction:"column",alignItems:"center",justifyContent:"flex-start",px:4,pt:{base:6,md:8},position:"relative",width:"100%",children:[(0,a.jsx)(s.xu,{fontSize:{base:"28px",md:"36px",lg:"46px"},fontWeight:"bold",whiteSpace:{base:"normal",md:"nowrap"},textAlign:"center",display:"inline-block",position:"relative",letterSpacing:{base:"1px",md:"2px"},px:3,mb:4,className:"gradient-text",sx:{background:"linear-gradient(90deg, #00BFFF, #0080FF, #1E90FF, #0080FF, #00BFFF)",backgroundSize:"200% auto",animation:"textFlow 3s linear infinite",backgroundClip:"text",textFillColor:"transparent",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"0 0 20px rgba(0, 150, 255, 0.5)",filter:"drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))"},children:r("10")||"KeyScreen 定制工具"}),(0,a.jsxs)(s.xu,{textAlign:"center",fontSize:{base:"12px",md:"14px",lg:"16px"},color:"rgba(255, 255, 255, 0.9)",maxW:"900px",bg:"rgba(20, 20, 40, 0.7)",p:{base:3,md:4},borderRadius:"8px",marginBottom:"30px",backdropFilter:"blur(5px)",width:{base:"95%",md:"90%"},borderLeft:"1px solid rgba(0, 150, 255, 0.6)",borderRight:"1px solid rgba(0, 150, 255, 0.6)",children:[r("12")||"轻松定制键盘右上角屏幕显示内容",(0,a.jsx)("br",{}),r("13")||"自定义图片、动画、文字，展示个性化效果",(0,a.jsx)("br",{}),r("14")||"多种布局模板，即插即用，一键设置"]}),(0,a.jsx)(y.z,{as:"button",onClick:()=>t([{vid:14e3,usagePage:65376,usage:97}]),bg:"rgba(0, 150, 255, 0.8)",color:"white",_hover:{bg:"rgba(0, 180, 255, 0.9)"},_active:{bg:"rgba(0, 120, 255, 1)"},borderRadius:"md",px:10,py:6,fontSize:"18px",fontWeight:"bold",boxShadow:"0 0 20px rgba(0, 150, 255, 0.5)",transition:"all 0.2s ease",position:"relative",marginBottom:"40px",_before:{content:'""',position:"absolute",top:"-3px",left:"-3px",right:"-3px",bottom:"-3px",borderRadius:"md",padding:"3px",background:"linear-gradient(90deg, #00BFFF, #0080FF, #1E90FF, #0080FF, #00BFFF)",mask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",maskComposite:"xor",animation:"textFlow 3s linear infinite"},children:(0,a.jsx)("span",{children:r("16")||"连接设备"})}),(0,a.jsxs)(s.xu,{w:{base:"90%",sm:"85%",md:"75%",lg:"65%"},maxW:"700px",borderRadius:"8px",overflow:"hidden",position:"relative",boxShadow:"0 0 40px rgba(0, 150, 255, 0.4)",mb:{base:"50px",md:"60px"},children:[(0,a.jsx)(s.xu,{position:"absolute",top:"-2px",left:"-2px",right:"-2px",bottom:"-2px",bg:"rgba(30, 30, 50, 0.95)",borderRadius:"10px",zIndex:0,boxShadow:"inset 0 0 10px rgba(0, 0, 0, 0.5)"}),(0,a.jsx)(s.xu,{position:"relative",zIndex:1,bg:"rgba(10, 10, 15, 0.95)",pt:"56.25%",overflow:"hidden",border:"4px solid rgba(40, 40, 60, 0.9)",borderRadius:"6px",sx:{animation:"screenFlicker 8s infinite"},children:(0,a.jsxs)(s.xu,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",bg:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",overflow:"hidden",children:[(0,a.jsx)(s.xu,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",children:(0,a.jsx)(B.E,{src:"./default/default1.gif",alt:"LCD Screen Animation",width:"100%",height:"100%",objectFit:"cover",style:{mixBlendMode:"lighten"}})}),(0,a.jsx)(s.xu,{position:"absolute",top:"0",left:"0",right:"0",height:"2px",bg:"rgba(255, 255, 255, 0.1)",sx:{animation:"scanline 3s linear infinite"}}),(0,a.jsx)(s.xu,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",backgroundImage:"url('./pixel_grid.png')",backgroundSize:"cover",opacity:.05,pointerEvents:"none"}),(0,a.jsx)(s.xu,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",bg:"rgba(0, 150, 255, 0.03)",sx:{animation:"pixelate 8s linear infinite"},pointerEvents:"none"})]})})]})]})]})]})}(0,K.E)(s.xu),(0,K.E)(y.z);var Z=o(9102),V=o.n(Z),$=function(){let{changeLanguage:e,i18n:t}=(0,q.$)("common"),{t:o}=(0,i.useContext)(c.T),n=async t=>{e(t)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V(),{id:"558a6080650750f3",children:'@-webkit-keyframes techGradient{0%{background-position:0%50%}50%{background-position:100%50%}100%{background-position:0%50%}}@-moz-keyframes techGradient{0%{background-position:0%50%}50%{background-position:100%50%}100%{background-position:0%50%}}@-o-keyframes techGradient{0%{background-position:0%50%}50%{background-position:100%50%}100%{background-position:0%50%}}@keyframes techGradient{0%{background-position:0%50%}50%{background-position:100%50%}100%{background-position:0%50%}}@-webkit-keyframes titlePulse{0%,100%{text-shadow:0 0 5px rgba(100,150,255,.5),0 0 10px rgba(100,150,255,.3),0 0 15px rgba(100,150,255,.2)}50%{text-shadow:0 0 10px rgba(100,150,255,.8),0 0 20px rgba(100,150,255,.6),0 0 30px rgba(100,150,255,.4)}}@-moz-keyframes titlePulse{0%,100%{text-shadow:0 0 5px rgba(100,150,255,.5),0 0 10px rgba(100,150,255,.3),0 0 15px rgba(100,150,255,.2)}50%{text-shadow:0 0 10px rgba(100,150,255,.8),0 0 20px rgba(100,150,255,.6),0 0 30px rgba(100,150,255,.4)}}@-o-keyframes titlePulse{0%,100%{text-shadow:0 0 5px rgba(100,150,255,.5),0 0 10px rgba(100,150,255,.3),0 0 15px rgba(100,150,255,.2)}50%{text-shadow:0 0 10px rgba(100,150,255,.8),0 0 20px rgba(100,150,255,.6),0 0 30px rgba(100,150,255,.4)}}@keyframes titlePulse{0%,100%{text-shadow:0 0 5px rgba(100,150,255,.5),0 0 10px rgba(100,150,255,.3),0 0 15px rgba(100,150,255,.2)}50%{text-shadow:0 0 10px rgba(100,150,255,.8),0 0 20px rgba(100,150,255,.6),0 0 30px rgba(100,150,255,.4)}}.tech-header{background:-webkit-linear-gradient(315deg,rgba(15,25,45,.95)0%,rgba(25,35,55,.95)25%,rgba(35,45,65,.95)50%,rgba(25,35,55,.95)75%,rgba(15,25,45,.95)100%);background:-moz-linear-gradient(315deg,rgba(15,25,45,.95)0%,rgba(25,35,55,.95)25%,rgba(35,45,65,.95)50%,rgba(25,35,55,.95)75%,rgba(15,25,45,.95)100%);background:-o-linear-gradient(315deg,rgba(15,25,45,.95)0%,rgba(25,35,55,.95)25%,rgba(35,45,65,.95)50%,rgba(25,35,55,.95)75%,rgba(15,25,45,.95)100%);background:linear-gradient(135deg,rgba(15,25,45,.95)0%,rgba(25,35,55,.95)25%,rgba(35,45,65,.95)50%,rgba(25,35,55,.95)75%,rgba(15,25,45,.95)100%);-webkit-background-size:400%400%;-moz-background-size:400%400%;-o-background-size:400%400%;background-size:400%400%;-webkit-animation:techGradient 8s ease infinite;-moz-animation:techGradient 8s ease infinite;-o-animation:techGradient 8s ease infinite;animation:techGradient 8s ease infinite;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);border-bottom:2px solid rgba(100,150,255,.3);-webkit-box-shadow:0 4px 20px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.1);-moz-box-shadow:0 4px 20px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.1);box-shadow:0 4px 20px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.1);position:relative}.tech-header::before{content:"";position:absolute;top:0;left:0;right:0;height:1px;background:-webkit-linear-gradient(left,transparent 0%,rgba(100,150,255,.6)50%,transparent 100%);background:-moz-linear-gradient(left,transparent 0%,rgba(100,150,255,.6)50%,transparent 100%);background:-o-linear-gradient(left,transparent 0%,rgba(100,150,255,.6)50%,transparent 100%);background:linear-gradient(90deg,transparent 0%,rgba(100,150,255,.6)50%,transparent 100%)}.tech-title{background:-webkit-linear-gradient(left,#667eea 0%,#764ba2 25%,#f093fb 50%,#764ba2 75%,#667eea 100%);background:-moz-linear-gradient(left,#667eea 0%,#764ba2 25%,#f093fb 50%,#764ba2 75%,#667eea 100%);background:-o-linear-gradient(left,#667eea 0%,#764ba2 25%,#f093fb 50%,#764ba2 75%,#667eea 100%);background:linear-gradient(90deg,#667eea 0%,#764ba2 25%,#f093fb 50%,#764ba2 75%,#667eea 100%);-webkit-background-size:200%auto;-moz-background-size:200%auto;-o-background-size:200%auto;background-size:200%auto;-webkit-animation:techGradient 4s linear infinite;-moz-animation:techGradient 4s linear infinite;-o-animation:techGradient 4s linear infinite;animation:techGradient 4s linear infinite;-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;color:transparent;font-weight:700;font-size:20px;letter-spacing:1px;-webkit-animation:titlePulse 3s ease-in-out infinite;-moz-animation:titlePulse 3s ease-in-out infinite;-o-animation:titlePulse 3s ease-in-out infinite;animation:titlePulse 3s ease-in-out infinite;display:inline-block;position:relative}.lang-button{background:rgba(100,150,255,.1);border:1px solid rgba(100,150,255,.3);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.lang-button:hover{background:rgba(100,150,255,.2);border-color:rgba(100,150,255,.5);-webkit-transform:translatey(-1px);-moz-transform:translatey(-1px);-ms-transform:translatey(-1px);-o-transform:translatey(-1px);transform:translatey(-1px);-webkit-box-shadow:0 4px 15px rgba(100,150,255,.2);-moz-box-shadow:0 4px 15px rgba(100,150,255,.2);box-shadow:0 4px 15px rgba(100,150,255,.2)}'}),(0,a.jsxs)(s.xu,{className:"tech-header",h:"68px",display:"flex",alignItems:"center",justifyContent:"space-between",px:6,position:"relative",zIndex:9e3,children:[(0,a.jsx)(s.xu,{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center",children:(0,a.jsx)(b.x,{className:"tech-title",children:o("11")})}),(0,a.jsx)(s.xu,{position:"absolute",right:6,children:(0,a.jsxs)(w.U,{spacing:3,justify:"flex-end",children:[(0,a.jsxs)(H.v,{children:[(0,a.jsx)(X.j,{px:3,py:2,borderRadius:"8px",cursor:"pointer",minW:"80px",bg:"rgba(100, 150, 255, 0.1)",border:"1px solid rgba(100, 150, 255, 0.3)",backdropFilter:"blur(8px)",transition:"all 0.3s ease",_hover:{bg:"rgba(100, 150, 255, 0.2)",borderColor:"rgba(100, 150, 255, 0.5)",transform:"translateY(-1px)",boxShadow:"0 4px 15px rgba(100, 150, 255, 0.2)"},children:(0,a.jsxs)(w.U,{spacing:2,align:"center",justify:"center",children:[(0,a.jsx)(S.$lZ,{size:16,color:"rgba(255, 255, 255, 0.8)"}),(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.9)",fontSize:"sm",fontWeight:"500",fontFamily:"monospace",whiteSpace:"nowrap",children:"cn"===t.language?"中文":"EN"})]})}),(0,a.jsxs)(O.q,{bg:"rgba(15, 25, 45, 0.95)",backdropFilter:"blur(12px)",border:"1px solid rgba(100, 150, 255, 0.3)",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",p:2,minW:"120px",children:[(0,a.jsx)(J.s,{onClick:()=>n("cn"),bg:"transparent",color:"rgba(255, 255, 255, 0.9)",borderRadius:"8px",fontSize:"sm",fontWeight:"500",_hover:{bg:"rgba(100, 150, 255, 0.2)",color:"white"},_focus:{bg:"rgba(100, 150, 255, 0.2)"},children:"中文 简体"}),(0,a.jsx)(J.s,{onClick:()=>n("en"),bg:"transparent",color:"rgba(255, 255, 255, 0.9)",borderRadius:"8px",fontSize:"sm",fontWeight:"500",_hover:{bg:"rgba(100, 150, 255, 0.2)",color:"white"},_focus:{bg:"rgba(100, 150, 255, 0.2)"},children:"English"})]})]}),(0,a.jsxs)(w.U,{spacing:1,align:"center",children:[(0,a.jsx)(b.x,{color:"rgba(255, 255, 255, 0.6)",fontSize:"xs",children:o("22")}),(0,a.jsx)(b.x,{color:"rgba(100, 150, 255, 0.8)",fontSize:"xs",fontFamily:"monospace",children:o("23")})]})]})})]})]})},ee=o(209),et=o(4873),eo=o(937),en=o(129),er=o(2250),ea=o(1957);function ei(e){let{isOpen:t,onRetry:o}=e,{keyBoardStatus:n,deviceComm:r,t:l,setDownLoad:s,connectMode:g,screenWidth:d,screenHeight:h}=(0,i.useContext)(c.T);return(0,a.jsxs)(ee.u_,{isOpen:t,onClose:()=>{},isCentered:!0,closeOnOverlayClick:!1,closeOnEsc:!1,children:[(0,a.jsx)(et.Z,{}),(0,a.jsxs)(eo.h,{children:[(0,a.jsx)(en.x,{color:"#000000",children:l("397")}),(0,a.jsx)(er.f,{children:(0,a.jsx)(b.x,{color:"red.500",fontWeight:"bold",children:l("398")})}),(0,a.jsx)(ea.m,{children:(0,a.jsx)(y.z,{colorScheme:"blue",onClick:o,children:l("399")})})]})]})}var el=function(){let{keyBoardStatus:e,deviceComm:t,keyBoardComm:n,screenOpen:b,setScreenOpen:u,t:f,appliedEditStates:m,setAppliedEditStates:w,setDownLoad:y,connectMode:S,screenWidth:j,screenHeight:k,connectDevice:C,qgifModule:v,setQgifModule:z}=(0,i.useContext)(c.T),F=(0,l.p)(),[I,R]=(0,i.useState)("home"),[E,D]=(0,i.useState)(!1),[M,T]=(0,i.useState)(null),[W,A]=(0,i.useState)([null,null,null]),[_,G]=(0,i.useState)([null,null,null]);(0,i.useEffect)(()=>{if((async()=>{if(!window.gifuct)try{let e=await o.e(841).then(o.bind(o,8841));window.gifuct=e,console.log("gifuct-js 加载成功")}catch(e){console.error("gifuct-js 加载失败:",e)}})(),!window.GIFEncoder){let e=document.createElement("script");e.src="https://jsd.cdn.zzko.cn/npm/gif.js@0.2.0/dist/gif.js",e.onload=()=>{},document.body.appendChild(e)}if(window.createModule)window.createModule().then(e=>z(e));else{let e=document.createElement("script");e.src="/qgif.js",e.onload=async()=>{z(await window.createModule())},document.body.appendChild(e)}},[]);let Y=(0,i.useCallback)(async()=>{n&&(u(!1),C([{usagePage:255,usage:1}]))},[b,n]);(0,i.useEffect)(()=>{if(n){t||n.openScreenMode();let e=setInterval(async()=>{t?clearInterval(e):await n.openScreenMode()},400);return()=>clearInterval(e)}},[n,t]);let{convertAndDownloadGifs:B}=function(e){let{gifFiles:t,qgifModule:o,deviceComm:n,onProgressUpdate:r,onProcessingChange:a,onResultsUpdate:i,screenWidth:s,screenHeight:c,t:b,keyBoardComm:u}=e,f=(0,l.p)();return{convertAndDownloadGifs:async()=>{if(!o||!window.gifuct){f({title:b("180"),description:b("181"),status:"error"});return}if(t.every(e=>!e)){f({title:b("182"),description:b("183"),status:"warning"});return}a(!0),r({status:"idle",currentScreen:0,totalScreens:t.length,bytesTransferred:0,totalBytes:0,percentage:0,message:b("184")});try{let e=new Uint8Array(65);e[1]=170,e[2]=27,e[6]=56,await n.setData(Array.from(e));let a=[];for(let e=0;e<t.length;e++){let t="applied_edit_".concat(e),o=sessionStorage.getItem(t);if(o)try{a[e]=JSON.parse(o),console.log("屏幕 ".concat(e+1," 应用编辑状态:"),a[e])}catch(o){console.warn("解析屏幕 ".concat(e+1," 编辑状态失败:"),o),a[e]=null;let t=new Uint8Array(65);t[1]=170,t[2]=26,t[6]=56,await n.setData(Array.from(t))}else a[e]=null}let l=[];for(let e=0;e<t.length;e++){let n=t[e];if(!n){console.log("屏幕 ".concat(e+1," 没有GIF文件，跳过")),l.push({qgifBin:new Uint8Array(0),size:0,frameCount:0,fps:0,screenIndex:e});continue}r({status:"idle",currentScreen:e,totalScreens:t.length,bytesTransferred:0,totalBytes:0,percentage:Math.round(e/t.length*100),message:"".concat(b("185")," ").concat(e+1," ").concat(b("186"))});try{console.log("开始处理屏幕 ".concat(e+1," 的GIF: ").concat(n.name));let t=await n.arrayBuffer(),r=new Uint8Array(t);console.log("文件读取完成，大小: ".concat(r.length," bytes")),await g(o),await d(o);let i=a[e];i&&console.log("应用编辑效果到屏幕 ".concat(e+1,":"),i);let p=window.gifuct.parseGIF(r),u=window.gifuct.decompressFrames(p,!0);console.log(u);let f=await h(r,o.FS,{targetWidth:s,targetHeight:c,defaultFps:10},i||void 0,b);console.log("GIF分解完成，共".concat(f,"帧"));let m=await x(o,f,10);console.log("屏幕 ".concat(e+1," QGIF数据:"),{size:m.length,frameCount:f,fps:10,hexPreview:Array.from(m.slice(0,32)).map(e=>e.toString(16).padStart(2,"0")).join(" ")+" ..."});let w=u.map(e=>e.delay||10),y=w.reduce((e,t)=>e+t,0)/w.length,S=y>0?Math.round(100/y):10;console.log(S,y),l.push({qgifBin:m,size:m.length,frameCount:f,fps:S,screenIndex:e})}catch(t){throw console.error("处理屏幕 ".concat(e+1," 的GIF失败:"),t),t}}console.log("所有GIF转换结果:",l.map(e=>({screen:e.screenIndex+1,size:e.size,frameCount:e.frameCount,fps:e.fps}))),i(l);let m=l.filter(e=>e.qgifBin.length>0);if(m.length>0&&n){r({status:"preparing",currentScreen:0,totalScreens:l.length,bytesTransferred:0,totalBytes:0,percentage:100,message:b("187")});let e=m.map(e=>e.qgifBin);console.log("准备下载到设备: ".concat(e.length," 个有效QGIF文件")),u.getGifCount(e.length),await p(e,n,r,b),f({title:b("188"),description:"".concat(b("189")," ").concat(m.length," ").concat(b("190")),status:"success"})}else m.length>0&&(r({status:"completed",currentScreen:l.length,totalScreens:l.length,bytesTransferred:0,totalBytes:0,percentage:100,message:b("191")}),f({title:b("192"),description:"".concat(b("193")," ").concat(m.length," ").concat(b("194")),status:"warning"}))}catch(e){console.error("GIF转换失败:",e),r({status:"error",currentScreen:0,totalScreens:t.length,bytesTransferred:0,totalBytes:0,percentage:0,message:"转换失败",error:e instanceof Error?e.message:"未知错误"}),f({title:"转换失败",description:e instanceof Error?e.message:"未知错误",status:"error"})}finally{a(!1)}},downloadToDevice:async e=>{if(!n){f({title:"设备未连接",description:"请确保设备已连接",status:"error"});return}let t=e.filter(e=>e.length>0);if(0===t.length){f({title:"没有数据",description:"没有有效的QGIF数据需要传输",status:"warning"});return}console.log("准备下载到设备: ".concat(t.length," 个有效QGIF文件")),a(!0);try{await p(t,n,r,b),f({title:b("188"),description:"".concat(b("189")," ").concat(t.length," ").concat(b("190")),status:"success"})}catch(e){console.error("下载到设备失败:",e),r({status:"error",currentScreen:0,totalScreens:t.length,bytesTransferred:0,totalBytes:0,percentage:0,message:b("194"),error:e instanceof Error?e.message:"未知错误"}),f({title:b("194"),description:e instanceof Error?e.message:"未知错误",status:"error"})}finally{a(!1)}}}}({gifFiles:W,qgifModule:v,deviceComm:t,keyBoardComm:n,onProgressUpdate:e=>{T(e),e.status===r.COMPLETED?F({title:f("100"),description:e.message,status:"success",duration:3e3}):e.status===r.ERROR&&F({title:f("101"),description:e.error||e.message,status:"error",duration:5e3})},onProcessingChange:e=>{D(e)},onResultsUpdate:e=>{console.log("转换结果:",e)},screenWidth:j,screenHeight:k,t:f});(0,i.useEffect)(()=>{e&&"home"===I?(R("editor"),F({title:f("102"),description:f("103"),status:"success",duration:2e3})):e||"editor"!==I||(R("home"),D(!1),F({title:f("104"),description:f("105"),status:"warning",duration:2e3}))},[e,I,F]),(0,i.useEffect)(()=>{(async()=>{try{console.log(await P().getItem("gifFilesData"));let e=await P().getItem("gifFilesData"),t=JSON.parse(localStorage.getItem("appliedEditStates")||"[]");console.log(e);let o=[null,null,null],n=[null,null,null];0===e.length||e.forEach((e,t)=>{if(e){let r=atob(e.data),a=Array(r.length);for(let e=0;e<r.length;e++)a[e]=r.charCodeAt(e);let i=new Uint8Array(a),l=new File([i],e.name,{type:e.type});o[t]=l,n[t]=URL.createObjectURL(l)}}),A(o),G(n),3===t.length&&w(t)}catch(e){console.error("从localStorage恢复数据失败:",e)}})()},[]);let H=(0,i.useCallback)(async(e,t)=>{if(!t.type.startsWith("image/gif")){F({title:f("106"),description:f("107"),status:"error"});return}try{let o=[...W];o[e]&&_[e]&&URL.revokeObjectURL(_[e]),o[e]=t,A(o);let n=[..._];n[e]=URL.createObjectURL(t),G(n);let r={name:t.name,type:t.type,data:await new Promise(e=>{let o=new FileReader;o.onload=()=>{let t=o.result;e(t.split(",")[1])},o.readAsDataURL(t)})},a=await P().getItem("gifFilesData")||["null","null","null"];a[e]=r,await P().setItem("gifFilesData",a),F({title:f("108"),description:"".concat(f("109")," ").concat(e+1," ").concat(f("110")),status:"success"})}catch(e){console.error("处理GIF文件失败:",e),F({title:f("111"),description:f("112"),status:"error"})}},[W,_,F]),X=(0,i.useCallback)(async()=>{_.forEach(e=>{e&&URL.revokeObjectURL(e)}),A([null,null,null]),G([null,null,null]),w([{isHue:0,brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[]},{isHue:0,brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[]},{isHue:0,brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[]}]),await P().removeItem("gifFilesData"),localStorage.removeItem("appliedEditStates"),F({title:f("113"),description:f("114"),status:"success"})},[_,F]),N=(0,i.useCallback)(async()=>{let e=W.filter(e=>null!==e);if(y(!0),0===e.length){F({title:f("115"),description:f("116"),status:"warning"});return}if(!t){F({title:f("117"),description:f("118"),status:"error"});return}if(!v){F({title:f("119"),description:f("120"),status:"error"});return}try{for(let e=0;e<m.length;e++){let t="applied_edit_".concat(e);sessionStorage.setItem(t,JSON.stringify(m[e]))}F({title:f("121"),description:"".concat(f("122")," ").concat(e.length," ").concat(f("123")),status:"info",duration:2e3}),console.log("convertAndDownloadGifs"),await B()}catch(e){console.error("下载过程出错:",e),F({title:f("124"),description:e instanceof Error?e.message:f("125"),status:"error",duration:5e3})}finally{y(!1)}},[W,m,t,v,B,F,y]),L=(0,i.useCallback)(e=>{w(e),localStorage.setItem("appliedEditStates",JSON.stringify(e))},[]);return(0,a.jsxs)(s.xu,{w:"100vw",h:"100vh",bg:"black",position:"relative",children:["editor"===I&&(0,a.jsx)($,{}),"home"===I?(0,a.jsx)(Q,{}):(0,a.jsxs)(s.xu,{w:"100%",h:"editor"===I?"calc(100vh - 68px)":"100vh",position:"relative",children:[(0,a.jsx)(U,{gifFiles:W,gifPreviews:_,appliedEditStates:m,onGifUpload:H,onAppliedEditStatesChange:L,onGifFilesChange:A,onGifPreviewsChange:G,onSyncTime:()=>{t&&t.syncTime()},onClearData:X,onDownloadToDevice:N,isDownloading:E,downloadProgress:M,screenWidth:j,screenHeight:k,t:f}),"USB"!==S&&(0,a.jsx)(s.xu,{position:"absolute",top:0,left:0,width:"100%",height:"100%",bg:"blackAlpha.800",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"xl",fontWeight:"bold",children:f("888")}),(0,a.jsx)(ei,{isOpen:b,onRetry:Y})]})]})}}}]);