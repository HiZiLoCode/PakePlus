(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{471:function(e,t,i){var n={"./cn/common.json":[2234,234],"./en/common.json":[1249,249]};function s(e){if(!i.o(n,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=n[e],s=t[0];return i.e(t[1]).then(function(){return i.t(s,19)})}s.keys=function(){return Object.keys(n)},s.id=471,e.exports=s},2157:function(e,t,i){Promise.resolve().then(i.bind(i,6911))},6911:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return o}});var n=i(7437),s=i(4232),r=i(4673);let a=(0,s.default)(()=>Promise.all([i.e(51),i.e(800),i.e(206),i.e(817)]).then(i.bind(i,5817)),{loadableGenerated:{webpack:()=>[5817]},ssr:!1,loading:()=>null});function o(){return(0,n.jsx)("main",{children:(0,n.jsx)(r.Z,{children:(0,n.jsx)(a,{})})})}},1093:function(e,t,i){"use strict";i.d(t,{$:function(){return u}});var n=i(2265),s=i(1505),r=i(2635),a=i(4457),o=i(5350);i(4870);let d="i18next",c=()=>navigator.language.toLowerCase().includes("zh")?"cn":"en";function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"common",t=arguments.length>1?arguments[1]:void 0,[i,s]=(0,a.fP)([d]),o=(0,r.$G)(e,t),{i18n:u}=o;return(0,n.useEffect)(()=>{let e=c(),t=(null==i?void 0:i.i18next)||e;u.changeLanguage(t),(null==i?void 0:i.i18next)||s(d,t,{path:"/"})},[i,u,s]),{...o,changeLanguage:e=>{u.changeLanguage(e),s(d,e,{path:"/"})}}}s.ZP.use(r.Db).use((0,o.Z)((e,t)=>i(471)("./".concat(e,"/").concat(t,".json")))).init({supportedLngs:["cn","en"],fallbackLng:"en",fallbackNS:"common",defaultNS:"common",lng:void 0})},4673:function(e,t,i){"use strict";i.d(t,{T:function(){return Q},Z:function(){return A}});var n=i(7437),s=i(2265);let r={},a={},o=e=>()=>Promise.race([new Promise((t,i)=>{e((e,n)=>{e?i(e):t(n)})}),new Promise((e,t)=>{setTimeout(()=>{e([])},1e3)})]),d=e=>e.filter(e=>{var t;return null===(t=e.collections)||void 0===t?void 0:t.some(e=>[255].includes(e.usagePage)&&[1].includes(e.usage))}),c=e=>e.filter(e=>{var t;return null===(t=e.collections)||void 0===t?void 0:t.some(e=>65376===e.usagePage&&97===e.usage)}),u=()=>self.crypto&&self.crypto.randomUUID&&self.crypto.randomUUID()||"path:".concat(Math.random()),h=e=>{var t,i;let n=e._address||u();e._address=n,console.log(e);let s={_device:e,interface:2,vendorId:null!==(t=e.vendorId)&&void 0!==t?t:-1,productId:null!==(i=e.productId)&&void 0!==i?i:-1,address:n,productName:e.productName||"Unknown Device",reportId:0,reportSize:64,reportCount:1};return v.hid_cache[n]=s},l=e=>{var t,i;let n=e._address||u();e._address=n;let s={_device:e,usage:97,usagePage:65376,interface:1,vendorId:null!==(t=e.vendorId)&&void 0!==t?t:-1,productId:null!==(i=e.productId)&&void 0!==i?i:-1,address:n,productName:e.productName||"Unknown Device"};return v.hid_cache[n]=s},v={hid_cache:{},requestDevice:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=await navigator.hid.requestDevice({filters:e}),i=65376===t[0].collections[0].usagePage?l:h;return t.forEach(i),t.sort((e,t)=>e.productId-t.productId)[0]},getFilteredDevices:async()=>{try{return d(await navigator.hid.getDevices())}catch(e){return[]}},devices:async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=await v.getFilteredDevices();if(0===i.length||e){try{await v.requestDevice(t)}catch(e){return[]}i=await v.getFilteredDevices()}let n=65376===i[0].collections[0].usagePage?l:h;return i.map(n)}},g={hid_cache:{},requestDevice:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=await navigator.hid.requestDevice({filters:e});return t.forEach(l),t.sort((e,t)=>e.productId-t.productId)[0]},getFilteredDevices:async()=>{try{return c(await navigator.hid.getDevices())}catch(e){return[]}},devices:async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=await g.getFilteredDevices();if(0===i.length||e){try{await g.requestDevice(t)}catch(e){return[]}i=await g.getFilteredDevices()}return i.map(l)}};class f{async open(){if(this._hidDevice&&!this._hidDevice._device.opened){this.openPromise=this._hidDevice._device.open(),this.setupListeners();try{await this.openPromise}catch(e){console.log(e)}}return Promise.resolve()}addListeners(e){this._hidDevice&&(this._hidDevice._device.oninputreport=e)}setupListeners(){this._hidDevice&&this._hidDevice._device.addEventListener("inputreport",e=>{0!==a[this.address].length?a[this.address].shift()(new Uint8Array(e.data.buffer)):r[this.address].push({currTime:Date.now(),message:new Uint8Array(e.data.buffer)})})}read(e){if(a[this.address]=[],this.fastForwardGlobalBuffer(Date.now()),r[this.address].length>0){var t;e(void 0,null===(t=r[this.address].shift())||void 0===t?void 0:t.message)}else a[this.address].push(t=>e(void 0,t))}fastForwardGlobalBuffer(e){let t=r[this.address].length;for(;t;)if(t--,r[this.address][0].currTime<e)r[this.address].shift();else break}async hid_write(e){var t;await this.openPromise;let i=new Uint8Array(e.slice(1));await (null===(t=this._hidDevice)||void 0===t?void 0:t._device.sendReport(e[0],i))}async hid_send_feature_report(e,t){var i,n;await this.openPromise;let s=new Uint8Array(t.slice(1));return await (null===(i=this._hidDevice)||void 0===i?void 0:i._device.sendFeatureReport(e,s)),await (null===(n=this._hidDevice)||void 0===n?void 0:n._device.receiveFeatureReport(e))}async hid_get_feature_report(e,t){var i;return await this.openPromise,new Uint8Array(t.slice(1)),await (null===(i=this._hidDevice)||void 0===i?void 0:i._device.receiveFeatureReport(e))}constructor(e){if(this.interface=-1,this.vendorId=-1,this.productId=-1,this.productName="",this.address="",this.openPromise=Promise.resolve(),this.readP=o(e=>this.read(e)),"demo"==e){this.vendorId=39578,this.productId=47802,this.productName="Test";return}this._hidDevice=v.hid_cache[e],this._hidDevice&&(this.vendorId=this._hidDevice.vendorId,this.productId=this._hidDevice.productId,this.address=this._hidDevice.address,this.interface=this._hidDevice.interface,this.productName=this._hidDevice.productName,r[this.address]=r[this.address]||[],a[this.address]=a[this.address]||[],this._hidDevice._device.opened||this.open())}}let p={},m={},_=e=>{let[t,i]=e;return i<<8|t},w=e=>new f(e);class D{getProductId(){return this.getHID().productId}getConnectMode(){return 1582==this.getProductId()?"USB":"2.4G"}refresh(e){this.address=e,p[e]={hid:w(e)}}get commandQueueWrapper(){return m[this.address]||(m[this.address]={isFlushing:!1,commandQueue:[]}),m[this.address]}async timeout(e){return new Promise((t,i)=>{this.commandQueueWrapper.commandQueue.push({res:t,rej:i,args:()=>new Promise(i=>setTimeout(()=>{i(),t(void 0)},e))}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}async getDeviceData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new Promise((t,i)=>{this.commandQueueWrapper.commandQueue.push({res:t,rej:i,args:["get",e]}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}async sendDeviceData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new Promise((t,i)=>{this.commandQueueWrapper.commandQueue.push({res:t,rej:i,args:["get",e]}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}async flushQueue(){if(!0!==this.commandQueueWrapper.isFlushing){for(this.commandQueueWrapper.isFlushing=!0;0!==this.commandQueueWrapper.commandQueue.length;){let{res:e,rej:t,args:i}=this.commandQueueWrapper.commandQueue.shift();if("function"==typeof i)await i(),e();else if("send_report"==i[0])try{let[t,...n]=i,s=await this.webhid_send_report(...n);e(s)}catch(e){t(e)}else try{let[t,...n]=i,s=await this.webhid_write_command(...n);e(s)}catch(e){t(e)}}this.commandQueueWrapper.isFlushing=!1}}getHID(){return p[this.address].hid}async webhid_read_command(){return this.getHID().readP()}async webhid_write_command(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[...e],i=Array(33).fill(0);t.forEach((e,t)=>{i[t]=e});try{await this.getHID().hid_write(i)}catch(e){console.log(e)}let n=Array.from(await this.webhid_read_command());return console.debug("Command for ".concat(this.address),t,"Correct Resp:",n),n}async webhid_send_command(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[...e],i=Array(33).fill(0);return t.forEach((e,t)=>{i[t]=e}),await this.getHID().write(i),console.debug("Command for ".concat(this.address),t),"success"}async webhid_send_report(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[...e],i=Array(33).fill(0);t.forEach((e,t)=>{i[t]=e});let n=await this.getHID().send(0,i);return console.debug("Command for ".concat(this.address),t,n),n}async sendReport(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new Promise((t,i)=>{this.commandQueueWrapper.commandQueue.push({res:t,rej:i,args:["send_report",e]}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}constructor(e){if(this.test=!1,this.address=e,"demo"==e)this.test=!0,p[e]={hid:new f(e)};else if(!p[e]){let t=w(e);p[e]={hid:t}}}}let y=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=await v.devices(!1,e);return(console.log(t),t.length>1)?new b(new D(t.sort((e,t)=>e.vendorId-t.vendorId)[0].address)):1==t.length?new b(new D(t[0].address)):void 0},I=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=await g.devices(!1,e);if(console.log(t),t.length>1)return new S(new D(t.sort((e,t)=>e.vendorId-t.vendorId)[0].address));if(1==t.length)return new S(new D(t[0].address));throw Error("No device found")};class b{addListeners(){this.api.getHID().addListeners(e=>{let t={},i=new Uint8Array(e.data.buffer);if(209==i[0]||210==i[0]){console.log(t=i);let e=this.onListeners.find(e=>"statu"==e.name);e&&e.fb(t)}})}async getConnectMode(){return this.api.getConnectMode()}async setData(e){return this.api.sendDeviceData(e)}async getDeviceInfo(){let e=Array(33).fill(0);e[0]=0,e[1]=48;let t=await this.setData(e);return{firmware_version:_([t[8],t[9]]),ic_type:t[10],report_max:t[11],charge_flag:t[12],battery_value:t[13],connect_status:t[14]}}async getConnectStatus(){let e=Array(65).fill(0);return e[1]=170,e[2]=28,{connect_status:(await this.setData(e))[9]}}async getScreenSize(){let e=Array(65).fill(0);e[1]=170,e[2]=16,this.setData(e);let t=Array(65).fill(0);t[1]=170,t[2]=18,t[6]=56;let i=await this.setData(t),n=Array(65).fill(0);return n[1]=170,n[2]=17,this.setData(n),{width:_([i[20],i[21]]),height:_([i[22],i[23]])}}async syncTime(){let e=Array(65).fill(0);e[1]=170,e[2]=16,this.setData(e);let t=Array(65).fill(0);t[1]=170,t[2]=23,t[6]=56;let i=new Date;console.log(i.getMonth()),t[9]=Math.floor(i.getFullYear()/1e3)%10,t[10]=i.getFullYear()/100%10,t[11]=i.getFullYear()/10%10,t[12]=i.getFullYear()%10;let n=i.getMonth()+1;t[13]=Math.floor(n/10)%10,t[14]=n%10,t[15]=i.getDay()%7,t[16]=i.getDate()/10%10,t[17]=i.getDate()%10,t[18]=i.getHours()/10%10,t[19]=i.getHours()%10,t[20]=i.getMinutes()/10%10,t[21]=i.getMinutes()%10,t[22]=i.getSeconds()/10%10,t[23]=i.getSeconds()%10,this.setData(t);let s=Array(65).fill(0);s[1]=170,s[2]=17,this.setData(s)}async sendImageData(e){this.setData(e)}constructor(e){this.demoMode=!1,this.vendorId=0,this.productId=0,this.productName="Test Mouse",this.onListeners=[],this.mode="usb",this.api=e;let t=this.api.getHID();this.vendorId=t.vendorId,this.productId=t.productId,this.productName=t.productName,this.addListeners()}}class S{addListeners(){this.api.getHID().addListeners(e=>{let t={},i=new Uint8Array(e.data.buffer);if(209==i[0]||210==i[0]){console.log(t=i);let e=this.onListeners.find(e=>"statu"==e.name);e&&e.fb(t)}})}async getConnectMode(){return this.api.getConnectMode()}async setData(e){return this.api.sendDeviceData(e)}async getScreenMode(){let e=Array(32).fill(0);return e[1]=170,e[2]=226,{screen_mode:1===(await this.setData(e))[8]}}async openScreenMode(){let e=Array(32).fill(0);return e[1]=170,e[2]=224,await this.setData(e),!0}async getGifCount(e){let t=Array(32).fill(0);t[1]=170,t[2]=227,t[6]=1,t[9]=e,await this.setData(t)}constructor(e){this.demoMode=!1,this.vendorId=0,this.productId=0,this.productName="Test Mouse",this.onListeners=[],this.mode="usb",this.api=e;let t=this.api.getHID();this.vendorId=t.vendorId,this.productId=t.productId,this.productName=t.productName,this.addListeners()}}var M=i(1093);class P{static startMonitoring(){if(!this._isMonitoring&&(this._isMonitoring=!0,!this._hasInitialized&&navigator.hid))try{navigator.hid.addEventListener("connect",this.onConnect),navigator.hid.addEventListener("disconnect",this.onDisconnect),this._hasInitialized=!0}catch(e){console.error("启动USB设备监控失败:",e),this._isMonitoring=!1}}static stopMonitoring(){this._isMonitoring=!1}static cleanup(){if(navigator.hid&&this._hasInitialized)try{navigator.hid.removeEventListener("connect",this.onConnect),navigator.hid.removeEventListener("disconnect",this.onDisconnect),this._listeners.connect.clear(),this._listeners.disconnect.clear(),this._listeners.remove.clear(),this._hasInitialized=!1,this._isMonitoring=!1}catch(e){console.error("清理USB设备监控资源失败:",e)}}static dispatchEvent(e,t){let i=Array.from(this._listeners[e]);0!==i.length&&i.forEach(i=>{try{i(t)}catch(t){console.error("执行".concat(e,"事件回调时出错:"),t)}})}static on(e,t){if(!t||"function"!=typeof t){console.error("无效的回调函数");return}if(!this._listeners[e]){console.error("不支持的事件类型: ".concat(e));return}this._listeners[e].add(t)}static off(e,t){if(t){if(!this._listeners[e]){console.error("不支持的事件类型: ".concat(e));return}this._listeners[e].delete(t)}}static isMonitoring(){return this._isMonitoring}}P._listeners={connect:new Set,disconnect:new Set,remove:new Set},P._isMonitoring=!1,P._hasInitialized=!1,P.onConnect=e=>{if(!P._isMonitoring)return;let{device:t}=e;P.dispatchEvent("connect",t)},P.onDisconnect=e=>{if(!P._isMonitoring)return;let{device:t}=e;P.dispatchEvent("disconnect",t),P.dispatchEvent("remove",t)};let Q=(0,s.createContext)({});var A=function(e){let{children:t}=e,[i,r]=(0,s.useState)(null),[a,o]=(0,s.useState)([{isHue:0,brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[]},{isHue:0,brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[]},{isHue:0,brightness:100,contrast:100,saturation:100,hue:0,scale:100,rotation:0,flipX:!1,flipY:!1,texts:[],drawings:[]}]),[d,c]=(0,s.useState)("1.0.1"),[u,h]=(0,s.useState)(),[l,v]=(0,s.useState)(),[g,f]=(0,s.useState)(!1),p=(0,s.useRef)(g),[m,_]=(0,s.useState)(!1),[w,D]=(0,s.useState)(!1),[b,S]=(0,s.useState)("USB"),[A,L]=(0,s.useState)(240),[N,E]=(0,s.useState)(136),[F,C]=(0,s.useState)(!1),[U,H]=(0,s.useState)(!1),{t:W}=(0,M.$)("common"),x=null;(0,s.useEffect)(()=>{console.log(g),p.current=g},[g]);let k=async e=>{console.log("设备断开:",e.productName,"VID:",e.vendorId,"PID:",e.productId,l),l&&e.vendorId===l.vendorId&&e.productId===l.productId&&(C(!1),v(void 0)),u&&u.vendorId===e.vendorId&&u.productId===e.productId&&(console.log("当前连接的设备已断开，更新状态"),D(!1),h(void 0),H(!0),clearInterval(x),x=null)},T=e=>{console.log("设备连接:",e.productName,"VID:",e.vendorId,"PID:",e.productId)};(0,s.useEffect)(()=>(P.startMonitoring(),P.on("disconnect",k),P.on("connect",T),()=>{P.off("disconnect",k),P.off("connect",T)}),[u,l]);let z=async(e,t)=>{if(t||!e)return;let i=Number((await e.getConnectStatus()).connect_status);if(S(["蓝牙","2.4G","USB"][i]),2!==i&&e){let t=new Uint8Array(65).fill(0);t[1]=170,t[2]=26,await e.setData(Array.from(t))}},j=async e=>{try{let t=await y(e);if(console.log(t),void 0===t)return console.log("connectedDevice undefined, not find device!"),H(!0),D(!1),h(void 0),!1;D(!0),h(t),t.syncTime(),await z(t),x=setInterval(async()=>{await z(t,p.current)},3e3);let i=await t.getScreenSize();return L(i.width),E(function(e,t){let i=e%t;if(0===i)return e;let n=e-i,s=n+t;return e-n<=s-e?n:s}(i.height,4)),console.log("screenSize",i),!0}catch(e){return console.error("连接设备失败:",e),D(!1),h(void 0),!1}},B=async e=>{try{let t=await I(e);if(void 0===t)return console.log("connectedDevice undefined, not find device!"),C(!1),v(void 0),!1;v(t),C(!0);let i=await t.getScreenMode();console.log(i.screen_mode,u,t),i.screen_mode&&u||H(!0)}catch(e){return!1}},G=async()=>{console.log(21321),D(!1),h(void 0)};return(0,n.jsx)(Q.Provider,{value:{qgifModule:i,setQgifModule:r,appliedEditStates:a,setAppliedEditStates:o,softwareVersion:d,deviceComm:u,connectDevice:j,connctKeyBoardDevice:B,disconnectDevice:G,keyBoardComm:l,setKeyBoardComm:v,demoMode:m,setDemoMode:_,downLoad:g,setDownLoad:f,connectMode:b,deviceStatus:w,setDeviceStatus:D,screenWidth:A,screenHeight:N,t:W,keyBoardStatus:F,screenOpen:U,setScreenOpen:H},children:t})}}},function(e){e.O(0,[771,971,69,744],function(){return e(e.s=2157)}),_N_E=e.O()}]);